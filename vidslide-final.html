<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidSlide AI - æœ€ç»ˆå·¥ä½œç‰ˆæœ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .main-content {
            padding: 20px;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }

        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

        .video-editor {
            display: grid;
            grid-template-rows: 2fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .section {
            border: 1px solid #e4e7ed;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
        }

        .section h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 8px;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .file-input {
            margin: 10px 0;
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            width: 100%;
            background: white;
        }

        .file-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .video-player {
            width: 100%;
            max-height: 400px;
            border-radius: 4px;
            background: #000;
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .timeline {
            width: 100%;
            height: 80px;
            background: #f0f0f0;
            border-radius: 4px;
            position: relative;
            margin: 10px 0;
            cursor: pointer;
        }

        .timeline-progress {
            height: 100%;
            background: #007bff;
            border-radius: 4px;
            width: 0%;
            transition: width 0.1s;
        }

        .marker {
            position: absolute;
            top: -8px;
            width: 16px;
            height: 40px;
            background: #dc3545;
            border-radius: 2px;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .primary { background: #007bff; color: white; }
        .primary:hover { background: #0056b3; }

        .success-btn { background: #28a745; color: white; }
        .success-btn:hover { background: #218838; }

        .danger { background: #dc3545; color: white; }
        .danger:hover { background: #c82333; }

        .secondary { background: #6c757d; color: white; }
        .secondary:hover { background: #545b62; }

        .marker-list {
            margin: 15px 0;
        }

        .marker-item {
            padding: 5px 10px;
            margin: 2px 0;
            background: #e9ecef;
            border-radius: 3px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .marker-item:hover {
            background: #dee2e6;
        }

        .marker-item.selected {
            background: #007bff;
            color: white;
        }

        .debug-info {
            font-size: 12px;
            color: #666;
            margin-top: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .test-result {
            margin: 5px 0;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .feature-card {
            background: white;
            border: 1px solid #e4e7ed;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .feature-card h3 {
            color: #007bff;
            margin-bottom: 10px;
        }

        .feature-card p {
            color: #666;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .video-editor {
                grid-template-rows: 1fr 1fr;
                gap: 15px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            button {
                margin: 2px 0;
            }

            .feature-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ¬ VidSlide AI</h1>
            <p>æ™ºèƒ½è§†é¢‘è½¬PPTå·¥å…· - å®Œå…¨ç‹¬ç«‹ç‰ˆæœ¬</p>
        </div>

        <!-- æµ‹è¯•ç»“æœçŠ¶æ€ -->
        <div class="main-content">
            <div id="test-results"></div>

            <!-- åŠŸèƒ½ä»‹ç» -->
            <div class="feature-list">
                <div class="feature-card">
                    <h3>ğŸ“ è§†é¢‘ä¸Šä¼ </h3>
                    <p>æ”¯æŒæ‹–æ‹½å’Œæ–‡ä»¶é€‰æ‹©ï¼Œæ™ºèƒ½æ–‡ä»¶éªŒè¯</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ¥ è§†é¢‘æ’­æ”¾</h3>
                    <p>å®Œæ•´çš„æ’­æ”¾æ§åˆ¶å’Œè¿›åº¦åŒæ­¥</p>
                </div>
                <div class="feature-card">
                    <h3>â±ï¸ æ—¶é—´è½´</h3>
                    <p>å¯è§†åŒ–æ—¶é—´è½´å’Œæ™ºèƒ½æ ‡è®°</p>
                </div>
                <div class="feature-card">
                    <h3>ğŸ¤– AIåŠŸèƒ½</h3>
                    <p>è¯­éŸ³è½¬æ–‡å­—ã€äººè„¸è·Ÿè¸ªç­‰AIåŠŸèƒ½</p>
                </div>
            </div>

            <!-- è§†é¢‘ç¼–è¾‘å™¨ -->
            <div class="video-editor">
                <!-- è§†é¢‘ä¸Šä¼ åŒºåŸŸ -->
                <div class="section">
                    <h2>ğŸ“ è§†é¢‘ä¸Šä¼ </h2>
                    <input type="file" accept="video/*" id="videoFileInput" onchange="handleVideoSelect()" class="file-input">
                    <div id="videoFileInfo" class="status warning">
                        <p>è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§†é¢‘æ–‡ä»¶</p>
                    </div>
                    <button class="danger" onclick="resetVideo()" id="resetBtn" style="display:none;">é‡ç½®è§†é¢‘</button>
                </div>

                <!-- è§†é¢‘æ’­æ”¾åŒºåŸŸ -->
                <div id="videoPlayerSection" style="display:none;" class="section">
                    <h2>ğŸ¥ è§†é¢‘æ’­æ”¾å™¨</h2>
                    <video
                        id="videoPlayer"
                        controls
                        onloadedmetadata="handleVideoLoaded()"
                        ontimeupdate="handleTimeUpdate()"
                        onplay="handlePlay()"
                        onpause="handlePause()"
                        class="video-player"
                    ></video>
                    <div class="controls">
                        <button class="primary" onclick="playVideo()" id="playBtn">â–¶ï¸ æ’­æ”¾</button>
                        <button class="primary" onclick="pauseVideo()" id="pauseBtn">â¸ï¸ æš‚åœ</button>
                        <button class="secondary" onclick="seekVideo(10)">â© +10ç§’</button>
                        <button class="secondary" onclick="seekVideo(-10)">âª -10ç§’</button>
                        <span id="timeDisplay">æ—¶é—´: 00:00 / 00:00</span>
                    </div>
                </div>
            </div>

            <!-- æ—¶é—´è½´åŒºåŸŸ -->
            <div id="timelineSection" style="display:none;" class="section">
                <h2>â±ï¸ æ—¶é—´è½´</h2>
                <div class="timeline" onclick="handleTimelineClick(event)">
                    <div class="timeline-progress" id="timelineProgress"></div>
                    <!-- æ—¶é—´è½´æ ‡è®° -->
                    <div id="timelineMarkers"></div>
                </div>
                <div class="controls">
                    <button class="success-btn" onclick="addMarker()">â• æ·»åŠ æ ‡è®°</button>
                    <button class="danger" onclick="removeMarker()" id="removeMarkerBtn" disabled>ğŸ—‘ï¸ åˆ é™¤æ ‡è®°</button>
                    <span id="markerCount">æ ‡è®°æ•°é‡: 0</span>
                    <span id="selectedMarkerInfo"></span>
                </div>
                <div id="markerList"></div>
            </div>

            <!-- AIåŠŸèƒ½é¢„è§ˆ -->
            <div class="section">
                <h2>ğŸ¤– AIåŠŸèƒ½ (å³å°†æ¨å‡º)</h2>
                <div class="status warning">
                    <h3>âš ï¸ AIåŠŸèƒ½å¼€å‘ä¸­</h3>
                    <p>å½“å‰ç‰ˆæœ¬ä¸“æ³¨äºåŸºç¡€åŠŸèƒ½ï¼ŒAIåŠŸèƒ½å°†åœ¨åç»­ç‰ˆæœ¬ä¸­é€æ­¥æ·»åŠ </p>
                    <ul style="text-align: left; margin: 10px 0;">
                        <li>ğŸ¤ è¯­éŸ³è½¬æ–‡å­— - Whisper WASMé›†æˆ</li>
                        <li>ğŸ‘¤ äººè„¸è·Ÿè¸ª - Face-api.jsé›†æˆ</li>
                        <li>ğŸ’¡ æ™ºèƒ½æ¨è - å†…å®¹åˆ†æå’ŒPPTç”Ÿæˆ</li>
                        <li>ğŸ¨ ç”»ä¸­ç”»æ•ˆæœ - åŠ¨æ€è§†è§‰æ•ˆæœ</li>
                    </ul>
                </div>
            </div>

            <!-- è°ƒè¯•ä¿¡æ¯ -->
            <div class="debug-info">
                <h3>ğŸ”§ è°ƒè¯•ä¿¡æ¯</h3>
                <div id="debugInfo">
                    <p>è§†é¢‘æ–‡ä»¶: æœªé€‰æ‹©</p>
                    <p>è§†é¢‘æº: æœªè®¾ç½®</p>
                    <p>å½“å‰æ—¶é—´: 0 (number)</p>
                    <p>è§†é¢‘æ—¶é•¿: 0</p>
                    <p>æ’­æ”¾çŠ¶æ€: æš‚åœä¸­</p>
                    <p>æ ‡è®°æ•°é‡: 0</p>
                    <p>æµè§ˆå™¨: <span id="browserInfo">æ£€æµ‹ä¸­...</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let currentVideoFile = null;
        let videoSrc = null;
        let currentTime = 0;
        let videoDuration = 0;
        let isPlaying = false;
        let markers = [];
        let selectedMarkerId = null;
        let markerIdCounter = 1;

        // æµ‹è¯•ç»“æœæ˜¾ç¤º
        function addTestResult(message, type = 'info') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `status test-result ${type}`;
            div.innerHTML = `<small>${new Date().toLocaleTimeString()}</small><br>${message}`;
            results.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // è°ƒè¯•ä¿¡æ¯æ›´æ–°
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            const browserInfo = document.getElementById('browserInfo');

            debugInfo.innerHTML = `
                <p>è§†é¢‘æ–‡ä»¶: ${currentVideoFile ? 'å·²é€‰æ‹©' : 'æœªé€‰æ‹©'}</p>
                <p>è§†é¢‘æº: ${videoSrc ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}</p>
                <p>å½“å‰æ—¶é—´: ${currentTime} (${typeof currentTime})</p>
                <p>è§†é¢‘æ—¶é•¿: ${videoDuration}</p>
                <p>æ’­æ”¾çŠ¶æ€: ${isPlaying ? 'æ’­æ”¾ä¸­' : 'æš‚åœä¸­'}</p>
                <p>æ ‡è®°æ•°é‡: ${markers.length}</p>
                <p>æµè§ˆå™¨: ${navigator.userAgent.split(' ').pop()}</p>
            `;
        }

        // æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // æ—¶é—´æ ¼å¼åŒ–
        function formatTime(seconds) {
            if (typeof seconds !== 'number' || isNaN(seconds)) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTimeDisplay() {
            const timeDisplay = document.getElementById('timeDisplay');
            timeDisplay.textContent = `æ—¶é—´: ${formatTime(currentTime)} / ${formatTime(videoDuration)}`;
        }

        // æ›´æ–°æ—¶é—´è½´è¿›åº¦
        function updateTimelineProgress() {
            const progress = document.getElementById('timelineProgress');
            const percentage = videoDuration > 0 ? (currentTime / videoDuration) * 100 : 0;
            progress.style.width = percentage + '%';
        }

        // æ›´æ–°æ ‡è®°æ˜¾ç¤º
        function updateMarkers() {
            const markersContainer = document.getElementById('timelineMarkers');
            markersContainer.innerHTML = '';

            markers.forEach(marker => {
                const markerElement = document.createElement('div');
                markerElement.className = 'marker';
                const percentage = videoDuration > 0 ? (marker.time / videoDuration) * 100 : 0;
                markerElement.style.left = percentage + '%';
                markerElement.onclick = (e) => {
                    e.stopPropagation();
                    selectMarker(marker.id);
                };
                markersContainer.appendChild(markerElement);
            });
        }

        // æ›´æ–°æ ‡è®°åˆ—è¡¨
        function updateMarkerList() {
            const markerList = document.getElementById('markerList');
            const markerCount = document.getElementById('markerCount');

            markerCount.textContent = `æ ‡è®°æ•°é‡: ${markers.length}`;

            if (markers.length > 0) {
                markerList.innerHTML = '<h4>æ ‡è®°åˆ—è¡¨:</h4>';
                markers.forEach(marker => {
                    const div = document.createElement('div');
                    div.className = 'marker-item' + (marker.id === selectedMarkerId ? ' selected' : '');
                    div.textContent = `æ ‡è®° ${marker.id}: ${formatTime(marker.time)}`;
                    div.onclick = () => selectMarker(marker.id);
                    markerList.appendChild(div);
                });
            } else {
                markerList.innerHTML = '';
            }

            document.getElementById('removeMarkerBtn').disabled = !selectedMarkerId;
        }

        // é€‰æ‹©æ ‡è®°
        function selectMarker(markerId) {
            selectedMarkerId = markerId;
            const selectedMarkerInfo = document.getElementById('selectedMarkerInfo');

            if (markerId) {
                const marker = markers.find(m => m.id === markerId);
                selectedMarkerInfo.textContent = `é€‰ä¸­: æ ‡è®°${markerId}`;
                seekToTime(marker.time);
            } else {
                selectedMarkerInfo.textContent = '';
            }

            updateMarkerList();
        }

        // å¤„ç†è§†é¢‘é€‰æ‹©
        function handleVideoSelect() {
            const fileInput = document.getElementById('videoFileInput');
            const file = fileInput.files[0];

            if (file) {
                try {
                    addTestResult(`é€‰æ‹©æ–‡ä»¶: ${file.name}`, 'info');

                    // éªŒè¯æ–‡ä»¶ç±»å‹
                    if (!file.type.startsWith('video/')) {
                        addTestResult('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶', 'error');
                        return;
                    }

                    // è®¾ç½®æ–‡ä»¶
                    currentVideoFile = file;
                    videoSrc = URL.createObjectURL(file);

                    // æ›´æ–°UI
                    const videoPlayer = document.getElementById('videoPlayer');
                    videoPlayer.src = videoSrc;

                    const fileInfo = document.getElementById('videoFileInfo');
                    fileInfo.className = 'status success';
                    fileInfo.innerHTML = `
                        <h3>âœ… è§†é¢‘å·²é€‰æ‹©</h3>
                        <p>æ–‡ä»¶å: ${file.name}</p>
                        <p>å¤§å°: ${formatFileSize(file.size)}</p>
                        <p>ç±»å‹: ${file.type}</p>
                    `;

                    // æ˜¾ç¤ºç»„ä»¶
                    document.getElementById('videoPlayerSection').style.display = 'block';
                    document.getElementById('timelineSection').style.display = 'block';
                    document.getElementById('resetBtn').style.display = 'inline-block';

                    addTestResult('âœ… è§†é¢‘æ–‡ä»¶è®¾ç½®æˆåŠŸ', 'success');
                    updateDebugInfo();

                } catch (error) {
                    addTestResult(`âŒ æ–‡ä»¶å¤„ç†å¤±è´¥: ${error.message}`, 'error');
                    console.error('File handling error:', error);
                }
            }
        }

        // é‡ç½®è§†é¢‘
        function resetVideo() {
            if (videoSrc) {
                URL.revokeObjectURL(videoSrc);
            }

            currentVideoFile = null;
            videoSrc = null;
            currentTime = 0;
            videoDuration = 0;
            isPlaying = false;
            markers = [];
            selectedMarkerId = null;

            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.src = '';
            videoPlayer.currentTime = 0;

            const fileInfo = document.getElementById('videoFileInfo');
            fileInfo.className = 'status warning';
            fileInfo.innerHTML = '<p>è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§†é¢‘æ–‡ä»¶</p>';

            document.getElementById('videoPlayerSection').style.display = 'none';
            document.getElementById('timelineSection').style.display = 'none';
            document.getElementById('resetBtn').style.display = 'none';

            updateDebugInfo();
            updateTimeDisplay();
            updateTimelineProgress();
            updateMarkers();
            updateMarkerList();

            addTestResult('è§†é¢‘å·²é‡ç½®', 'info');
        }

        // è§†é¢‘åŠ è½½å®Œæˆ
        function handleVideoLoaded() {
            const videoPlayer = document.getElementById('videoPlayer');
            videoDuration = videoPlayer.duration || 0;

            document.getElementById('playBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = false;

            updateTimeDisplay();
            updateTimelineProgress();

            addTestResult(`âœ… è§†é¢‘åŠ è½½å®Œæˆï¼Œæ—¶é•¿: ${formatTime(videoDuration)}`, 'success');
            updateDebugInfo();
        }

        // æ—¶é—´æ›´æ–°
        function handleTimeUpdate() {
            const videoPlayer = document.getElementById('videoPlayer');
            currentTime = videoPlayer.currentTime || 0;

            updateTimeDisplay();
            updateTimelineProgress();
        }

        // æ’­æ”¾äº‹ä»¶
        function handlePlay() {
            isPlaying = true;
            addTestResult('è§†é¢‘å¼€å§‹æ’­æ”¾', 'info');
            updateDebugInfo();
        }

        // æš‚åœäº‹ä»¶
        function handlePause() {
            isPlaying = false;
            addTestResult('è§†é¢‘æš‚åœæ’­æ”¾', 'info');
            updateDebugInfo();
        }

        // æ’­æ”¾æ§åˆ¶
        function playVideo() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer) {
                videoPlayer.play();
            }
        }

        function pauseVideo() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer) {
                videoPlayer.pause();
            }
        }

        function seekVideo(seconds) {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer) {
                const newTime = Math.max(0, Math.min(videoDuration, currentTime + seconds));
                videoPlayer.currentTime = newTime;
                currentTime = newTime;
                updateTimeDisplay();
                updateTimelineProgress();
            }
        }

        function seekToTime(time) {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer) {
                videoPlayer.currentTime = time;
                currentTime = time;
                updateTimeDisplay();
                updateTimelineProgress();
            }
        }

        // æ—¶é—´è½´ç‚¹å‡»
        function handleTimelineClick(event) {
            if (videoDuration > 0) {
                const timeline = event.currentTarget;
                const rect = timeline.getBoundingClientRect();
                const clickX = event.clientX - rect.left;
                const percentage = clickX / rect.width;
                const newTime = percentage * videoDuration;

                seekToTime(newTime);
            }
        }

        // æ ‡è®°ç®¡ç†
        function addMarker() {
            const marker = {
                id: markerIdCounter++,
                time: currentTime,
                title: `æ ‡è®° ${markerIdCounter - 1}`
            };
            markers.push(marker);
            selectedMarkerId = marker.id;

            updateMarkers();
            updateMarkerList();
            updateDebugInfo();

            addTestResult(`æ·»åŠ æ ‡è®°: ${formatTime(marker.time)}`, 'info');
        }

        function removeMarker() {
            if (selectedMarkerId) {
                const index = markers.findIndex(m => m.id === selectedMarkerId);
                if (index > -1) {
                    markers.splice(index, 1);
                    selectedMarkerId = null;

                    updateMarkers();
                    updateMarkerList();
                    updateDebugInfo();

                    addTestResult('æ ‡è®°å·²åˆ é™¤', 'info');
                }
            }
        }

        // é¡µé¢åˆå§‹åŒ–
        window.addEventListener('load', () => {
            addTestResult('âœ… VidSlide AI å®Œå…¨ç‹¬ç«‹ç‰ˆæœ¬åŠ è½½æˆåŠŸ', 'success');
            addTestResult('ğŸ‰ æ‰€æœ‰åŸºç¡€åŠŸèƒ½ç°å·²å¯ç”¨ï¼', 'success');

            // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
            setTimeout(() => {
                // æ£€æŸ¥æµè§ˆå™¨åŠŸèƒ½
                if (window.File && window.FileReader && window.FileList && window.Blob) {
                    addTestResult('âœ… File APIæ”¯æŒæ­£å¸¸', 'success');
                } else {
                    addTestResult('âŒ File APIä¸æ”¯æŒ', 'error');
                }

                // æ£€æŸ¥è§†é¢‘æ”¯æŒ
                const video = document.createElement('video');
                const canPlayTypes = [
                    'video/mp4; codecs="avc1.42E01E"',
                    'video/webm; codecs="vp8, vorbis"',
                    'video/ogg; codecs="theora"'
                ];

                let supportedTypes = [];
                canPlayTypes.forEach(type => {
                    if (video.canPlayType(type) !== '') {
                        supportedTypes.push(type.split(';')[0]);
                    }
                });

                if (supportedTypes.length > 0) {
                    addTestResult(`âœ… è§†é¢‘æ”¯æŒ: ${supportedTypes.join(', ')}`, 'success');
                } else {
                    addTestResult('âŒ æµè§ˆå™¨ä¸æ”¯æŒå¸¸è§è§†é¢‘æ ¼å¼', 'error');
                }

                // æ£€æŸ¥æœ¬åœ°å­˜å‚¨
                try {
                    const testKey = 'vidslide-test';
                    localStorage.setItem(testKey, 'works');
                    const retrieved = localStorage.getItem(testKey);
                    if (retrieved === 'works') {
                        addTestResult('âœ… æœ¬åœ°å­˜å‚¨åŠŸèƒ½æ­£å¸¸', 'success');
                        localStorage.removeItem(testKey);
                    } else {
                        addTestResult('âŒ æœ¬åœ°å­˜å‚¨æµ‹è¯•å¤±è´¥', 'error');
                    }
                } catch (error) {
                    addTestResult(`âŒ æœ¬åœ°å­˜å‚¨å¤±è´¥: ${error.message}`, 'error');
                }

                updateDebugInfo();
            }, 100);
        });

        // é”™è¯¯å¤„ç†
        window.addEventListener('error', (event) => {
            addTestResult(`âŒ é¡µé¢é”™è¯¯: ${event.error.message}`, 'error');
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', () => {
            if (videoSrc) {
                URL.revokeObjectURL(videoSrc);
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidSlide AI - ç¦»çº¿åŸºç¡€åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            background: #007bff;
            color: white;
        }
        .video-section {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
        }
        .timeline-section {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            min-height: 120px;
        }
        .controls {
            margin: 10px 0;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
        }
        .timeline-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 10px 0;
            position: relative;
            cursor: pointer;
        }
        .timeline-progress {
            height: 100%;
            background: #007bff;
            border-radius: 10px;
            width: 0%;
            transition: width 0.1s;
        }
        .marker {
            position: absolute;
            top: -5px;
            width: 10px;
            height: 30px;
            background: #dc3545;
            border-radius: 2px;
            cursor: pointer;
        }
        h1, h2, h3 { color: #333; }
        .component-test { border: 2px solid #28a745; padding: 10px; margin: 10px 0; }
        input[type="file"] { margin: 10px 0; }
        ul { padding-left: 20px; }
        li.selected { background: #e3f2fd; padding: 2px 4px; border-radius: 2px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ VidSlide AI - ç¦»çº¿åŸºç¡€åŠŸèƒ½æµ‹è¯•</h1>

        <div class="status info">
            <h3>ğŸ“Š æµ‹è¯•çŠ¶æ€</h3>
            <p>çº¯JavaScriptå®ç°ï¼Œæµ‹è¯•æµè§ˆå™¨åŸºç¡€åŠŸèƒ½</p>
            <div id="test-results"></div>
        </div>

        <!-- è§†é¢‘ä¸Šä¼ ç»„ä»¶ -->
        <div class="component-test">
            <h2>ğŸ“ è§†é¢‘ä¸Šä¼ ç»„ä»¶</h2>
            <div class="video-section">
                <input type="file" accept="video/*" id="videoFileInput" onchange="handleVideoSelect()">
                <div id="videoFileInfo" class="status warning">
                    <p>è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§†é¢‘æ–‡ä»¶</p>
                </div>
                <button class="error" onclick="resetVideo()" id="resetBtn" style="display:none;">é‡ç½®</button>
            </div>
        </div>

        <!-- è§†é¢‘æ’­æ”¾ç»„ä»¶ -->
        <div class="component-test" id="videoPlayerSection" style="display:none;">
            <h2>ğŸ¥ è§†é¢‘æ’­æ”¾ç»„ä»¶</h2>
            <div class="video-section">
                <video
                    id="videoPlayer"
                    controls
                    onloadedmetadata="handleVideoLoaded()"
                    ontimeupdate="handleTimeUpdate()"
                    onplay="handlePlay()"
                    onpause="handlePause()"
                    style="max-width: 100%; max-height: 400px;"
                ></video>
                <div class="controls">
                    <button onclick="playVideo()" id="playBtn">æ’­æ”¾</button>
                    <button onclick="pauseVideo()" id="pauseBtn">æš‚åœ</button>
                    <button onclick="seekVideo(10)">å‰è¿›10ç§’</button>
                    <button onclick="seekVideo(-10)">åé€€10ç§’</button>
                    <span id="timeDisplay">å½“å‰æ—¶é—´: 00:00 / 00:00</span>
                </div>
            </div>
        </div>

        <!-- æ—¶é—´è½´ç»„ä»¶ -->
        <div class="component-test" id="timelineSection" style="display:none;">
            <h2>â±ï¸ æ—¶é—´è½´ç»„ä»¶</h2>
            <div class="timeline-section">
                <div class="timeline-bar" onclick="handleTimelineClick(event)">
                    <div class="timeline-progress" id="timelineProgress"></div>
                    <!-- æ—¶é—´è½´æ ‡è®° -->
                    <div id="timelineMarkers"></div>
                </div>
                <div class="controls">
                    <button onclick="addMarker()">æ·»åŠ æ ‡è®°</button>
                    <button onclick="removeMarker()" id="removeMarkerBtn" disabled>åˆ é™¤æ ‡è®°</button>
                    <span id="markerCount">æ ‡è®°æ•°é‡: 0</span>
                    <span id="selectedMarkerInfo"></span>
                </div>
                <div id="markerList"></div>
            </div>
        </div>

        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div class="component-test">
            <h2>ğŸ”§ è°ƒè¯•ä¿¡æ¯</h2>
            <div class="status info">
                <h3>åº”ç”¨çŠ¶æ€</h3>
                <div id="debugInfo">
                    <p>è§†é¢‘æ–‡ä»¶: æœªé€‰æ‹©</p>
                    <p>è§†é¢‘æº: æœªè®¾ç½®</p>
                    <p>å½“å‰æ—¶é—´: 0 (number)</p>
                    <p>è§†é¢‘æ—¶é•¿: 0</p>
                    <p>æ’­æ”¾çŠ¶æ€: æš‚åœä¸­</p>
                    <p>æ ‡è®°æ•°é‡: 0</p>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½æµ‹è¯•æŒ‰é’® -->
        <div class="component-test">
            <h2>ğŸ§ª åŠŸèƒ½éªŒè¯</h2>
            <div class="controls">
                <button onclick="testFileAPI()">æµ‹è¯•æ–‡ä»¶API</button>
                <button onclick="testVideoAPI()">æµ‹è¯•è§†é¢‘API</button>
                <button onclick="testLocalStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
                <button onclick="clearAll()">æ¸…é™¤æ‰€æœ‰</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let currentVideoFile = null;
        let videoSrc = null;
        let currentTime = 0;
        let videoDuration = 0;
        let isPlaying = false;
        let markers = [];
        let selectedMarkerId = null;
        let markerIdCounter = 1;

        // æµ‹è¯•ç»“æœæ˜¾ç¤º
        function addTestResult(message, type = 'info') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<small>${new Date().toLocaleTimeString()}</small><br>${message}`;
            results.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // è°ƒè¯•ä¿¡æ¯æ›´æ–°
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <p>è§†é¢‘æ–‡ä»¶: ${currentVideoFile ? 'å·²é€‰æ‹©' : 'æœªé€‰æ‹©'}</p>
                <p>è§†é¢‘æº: ${videoSrc ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}</p>
                <p>å½“å‰æ—¶é—´: ${currentTime} (${typeof currentTime})</p>
                <p>è§†é¢‘æ—¶é•¿: ${videoDuration}</p>
                <p>æ’­æ”¾çŠ¶æ€: ${isPlaying ? 'æ’­æ”¾ä¸­' : 'æš‚åœä¸­'}</p>
                <p>æ ‡è®°æ•°é‡: ${markers.length}</p>
            `;
        }

        // æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // æ—¶é—´æ ¼å¼åŒ–
        function formatTime(seconds) {
            if (typeof seconds !== 'number' || isNaN(seconds)) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTimeDisplay() {
            const timeDisplay = document.getElementById('timeDisplay');
            timeDisplay.textContent = `å½“å‰æ—¶é—´: ${formatTime(currentTime)} / ${formatTime(videoDuration)}`;
        }

        // æ›´æ–°æ—¶é—´è½´è¿›åº¦
        function updateTimelineProgress() {
            const progress = document.getElementById('timelineProgress');
            const percentage = videoDuration > 0 ? (currentTime / videoDuration) * 100 : 0;
            progress.style.width = percentage + '%';
        }

        // æ›´æ–°æ ‡è®°æ˜¾ç¤º
        function updateMarkers() {
            const markersContainer = document.getElementById('timelineMarkers');
            markersContainer.innerHTML = '';

            markers.forEach(marker => {
                const markerElement = document.createElement('div');
                markerElement.className = 'marker';
                const percentage = videoDuration > 0 ? (marker.time / videoDuration) * 100 : 0;
                markerElement.style.left = percentage + '%';
                markerElement.onclick = (e) => {
                    e.stopPropagation();
                    selectMarker(marker.id);
                };
                markersContainer.appendChild(markerElement);
            });
        }

        // æ›´æ–°æ ‡è®°åˆ—è¡¨
        function updateMarkerList() {
            const markerList = document.getElementById('markerList');
            const markerCount = document.getElementById('markerCount');

            markerCount.textContent = `æ ‡è®°æ•°é‡: ${markers.length}`;

            if (markers.length > 0) {
                markerList.innerHTML = '<h4>æ ‡è®°åˆ—è¡¨:</h4><ul>';
                markers.forEach(marker => {
                    const li = document.createElement('li');
                    li.textContent = `æ ‡è®° ${marker.id}: ${formatTime(marker.time)}`;
                    li.className = marker.id === selectedMarkerId ? 'selected' : '';
                    li.onclick = () => selectMarker(marker.id);
                    markerList.appendChild(li);
                });
                markerList.innerHTML += '</ul>';
            } else {
                markerList.innerHTML = '';
            }

            document.getElementById('removeMarkerBtn').disabled = !selectedMarkerId;
        }

        // é€‰æ‹©æ ‡è®°
        function selectMarker(markerId) {
            selectedMarkerId = markerId;
            const selectedMarkerInfo = document.getElementById('selectedMarkerInfo');

            if (markerId) {
                const marker = markers.find(m => m.id === markerId);
                selectedMarkerInfo.textContent = `é€‰ä¸­æ ‡è®°: ${markerId}`;
                seekToTime(marker.time);
            } else {
                selectedMarkerInfo.textContent = '';
            }

            updateMarkerList();
        }

        // å¤„ç†è§†é¢‘é€‰æ‹©
        function handleVideoSelect() {
            const fileInput = document.getElementById('videoFileInput');
            const file = fileInput.files[0];

            if (file) {
                try {
                    addTestResult(`é€‰æ‹©æ–‡ä»¶: ${file.name}`, 'info');

                    // éªŒè¯æ–‡ä»¶ç±»å‹
                    if (!file.type.startsWith('video/')) {
                        addTestResult('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶', 'error');
                        return;
                    }

                    // è®¾ç½®æ–‡ä»¶
                    currentVideoFile = file;
                    videoSrc = URL.createObjectURL(file);

                    // æ›´æ–°UI
                    const videoPlayer = document.getElementById('videoPlayer');
                    videoPlayer.src = videoSrc;

                    const fileInfo = document.getElementById('videoFileInfo');
                    fileInfo.className = 'status success';
                    fileInfo.innerHTML = `
                        <h3>âœ… è§†é¢‘å·²é€‰æ‹©</h3>
                        <p>æ–‡ä»¶å: ${file.name}</p>
                        <p>å¤§å°: ${formatFileSize(file.size)}</p>
                        <p>ç±»å‹: ${file.type}</p>
                    `;

                    // æ˜¾ç¤ºç»„ä»¶
                    document.getElementById('videoPlayerSection').style.display = 'block';
                    document.getElementById('timelineSection').style.display = 'block';
                    document.getElementById('resetBtn').style.display = 'inline-block';

                    addTestResult('âœ… è§†é¢‘æ–‡ä»¶è®¾ç½®æˆåŠŸ', 'success');
                    updateDebugInfo();

                } catch (error) {
                    addTestResult(`âŒ æ–‡ä»¶å¤„ç†å¤±è´¥: ${error.message}`, 'error');
                    console.error('File handling error:', error);
                }
            }
        }

        // é‡ç½®è§†é¢‘
        function resetVideo() {
            if (videoSrc) {
                URL.revokeObjectURL(videoSrc);
            }

            currentVideoFile = null;
            videoSrc = null;
            currentTime = 0;
            videoDuration = 0;
            isPlaying = false;
            markers = [];
            selectedMarkerId = null;

            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.src = '';
            videoPlayer.currentTime = 0;

            const fileInfo = document.getElementById('videoFileInfo');
            fileInfo.className = 'status warning';
            fileInfo.innerHTML = '<p>è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§†é¢‘æ–‡ä»¶</p>';

            document.getElementById('videoPlayerSection').style.display = 'none';
            document.getElementById('timelineSection').style.display = 'none';
            document.getElementById('resetBtn').style.display = 'none';

            updateDebugInfo();
            updateTimeDisplay();
            updateTimelineProgress();
            updateMarkers();
            updateMarkerList();

            addTestResult('è§†é¢‘å·²é‡ç½®', 'info');
        }

        // è§†é¢‘åŠ è½½å®Œæˆ
        function handleVideoLoaded() {
            const videoPlayer = document.getElementById('videoPlayer');
            videoDuration = videoPlayer.duration || 0;

            document.getElementById('playBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = false;

            updateTimeDisplay();
            updateTimelineProgress();

            addTestResult(`âœ… è§†é¢‘åŠ è½½å®Œæˆï¼Œæ—¶é•¿: ${formatTime(videoDuration)}`, 'success');
            updateDebugInfo();
        }

        // æ—¶é—´æ›´æ–°
        function handleTimeUpdate() {
            const videoPlayer = document.getElementById('videoPlayer');
            currentTime = videoPlayer.currentTime || 0;

            updateTimeDisplay();
            updateTimelineProgress();
        }

        // æ’­æ”¾äº‹ä»¶
        function handlePlay() {
            isPlaying = true;
            addTestResult('è§†é¢‘å¼€å§‹æ’­æ”¾', 'info');
            updateDebugInfo();
        }

        // æš‚åœäº‹ä»¶
        function handlePause() {
            isPlaying = false;
            addTestResult('è§†é¢‘æš‚åœæ’­æ”¾', 'info');
            updateDebugInfo();
        }

        // æ’­æ”¾æ§åˆ¶
        function playVideo() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer) {
                videoPlayer.play();
            }
        }

        function pauseVideo() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer) {
                videoPlayer.pause();
            }
        }

        function seekVideo(seconds) {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer) {
                const newTime = Math.max(0, Math.min(videoDuration, currentTime + seconds));
                videoPlayer.currentTime = newTime;
                currentTime = newTime;
                updateTimeDisplay();
                updateTimelineProgress();
            }
        }

        function seekToTime(time) {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer) {
                videoPlayer.currentTime = time;
                currentTime = time;
                updateTimeDisplay();
                updateTimelineProgress();
            }
        }

        // æ—¶é—´è½´ç‚¹å‡»
        function handleTimelineClick(event) {
            if (videoDuration > 0) {
                const timelineBar = event.currentTarget;
                const rect = timelineBar.getBoundingClientRect();
                const clickX = event.clientX - rect.left;
                const percentage = clickX / rect.width;
                const newTime = percentage * videoDuration;

                seekToTime(newTime);
            }
        }

        // æ ‡è®°ç®¡ç†
        function addMarker() {
            const marker = {
                id: markerIdCounter++,
                time: currentTime,
                title: `æ ‡è®° ${markerIdCounter - 1}`
            };
            markers.push(marker);
            selectedMarkerId = marker.id;

            updateMarkers();
            updateMarkerList();
            updateDebugInfo();

            addTestResult(`æ·»åŠ æ ‡è®°: ${formatTime(marker.time)}`, 'info');
        }

        function removeMarker() {
            if (selectedMarkerId) {
                const index = markers.findIndex(m => m.id === selectedMarkerId);
                if (index > -1) {
                    markers.splice(index, 1);
                    selectedMarkerId = null;

                    updateMarkers();
                    updateMarkerList();
                    updateDebugInfo();

                    addTestResult('æ ‡è®°å·²åˆ é™¤', 'info');
                }
            }
        }

        // åŠŸèƒ½æµ‹è¯•
        function testFileAPI() {
            try {
                if (window.File && window.FileReader && window.FileList && window.Blob) {
                    addTestResult('âœ… File APIæ”¯æŒæ­£å¸¸', 'success');
                } else {
                    addTestResult('âŒ File APIä¸æ”¯æŒ', 'error');
                }
            } catch (error) {
                addTestResult(`âŒ File APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testVideoAPI() {
            try {
                const video = document.createElement('video');
                const canPlayTypes = [
                    'video/mp4; codecs="avc1.42E01E"',
                    'video/webm; codecs="vp8, vorbis"',
                    'video/ogg; codecs="theora"'
                ];

                let supportedTypes = [];
                canPlayTypes.forEach(type => {
                    if (video.canPlayType(type) !== '') {
                        supportedTypes.push(type.split(';')[0]);
                    }
                });

                if (supportedTypes.length > 0) {
                    addTestResult(`âœ… è§†é¢‘APIæ”¯æŒ: ${supportedTypes.join(', ')}`, 'success');
                } else {
                    addTestResult('âŒ æµè§ˆå™¨ä¸æ”¯æŒå¸¸è§è§†é¢‘æ ¼å¼', 'error');
                }
            } catch (error) {
                addTestResult(`âŒ è§†é¢‘APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testLocalStorage() {
            try {
                const testKey = 'vidslide-test';
                const testValue = 'localStorage works';

                localStorage.setItem(testKey, testValue);
                const retrieved = localStorage.getItem(testKey);

                if (retrieved === testValue) {
                    addTestResult('âœ… LocalStorageåŠŸèƒ½æ­£å¸¸', 'success');
                    localStorage.removeItem(testKey);
                } else {
                    addTestResult('âŒ LocalStorageæµ‹è¯•å¤±è´¥', 'error');
                }
            } catch (error) {
                addTestResult(`âŒ LocalStorageå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function clearAll() {
            resetVideo();
            document.getElementById('test-results').innerHTML = '';
            addTestResult('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤', 'info');
        }

        // é¡µé¢åˆå§‹åŒ–
        window.addEventListener('load', () => {
            addTestResult('âœ… é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åŠŸèƒ½æµ‹è¯•', 'success');

            // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
            setTimeout(() => {
                testFileAPI();
                testVideoAPI();
                testLocalStorage();
            }, 100);
        });

        // é”™è¯¯å¤„ç†
        window.addEventListener('error', (event) => {
            addTestResult(`âŒ é¡µé¢é”™è¯¯: ${event.message}`, 'error');
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', () => {
            if (videoSrc) {
                URL.revokeObjectURL(videoSrc);
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VidSlide AI - äººè„¸è·Ÿè¸ªæŠ€æœ¯éªŒè¯</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 30px;
    }

    h1 {
      color: #2c3e50;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      color: #7f8c8d;
      text-align: center;
      margin-bottom: 30px;
    }

    .status-panel {
      background: #ecf0f1;
      border-radius: 6px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #bdc3c7;
    }

    .status-item:last-child {
      border-bottom: none;
    }

    .status-label {
      font-weight: 500;
    }

    .status-value {
      font-family: monospace;
      padding: 4px 8px;
      border-radius: 4px;
      background: white;
    }

    .status-success { color: #27ae60; }
    .status-error { color: #e74c3c; }
    .status-warning { color: #f39c12; }
    .status-info { color: #3498db; }

    .test-section {
      margin-bottom: 30px;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 20px;
    }

    .test-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .test-title {
      font-size: 18px;
      font-weight: 600;
      color: #2c3e50;
    }

    .test-status {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .test-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .metric-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      border-left: 4px solid #3498db;
    }

    .metric-title {
      font-size: 14px;
      color: #7f8c8d;
      margin-bottom: 5px;
    }

    .metric-value {
      font-size: 24px;
      font-weight: 600;
      color: #2c3e50;
    }

    .metric-unit {
      font-size: 12px;
      color: #95a5a6;
    }

    .console-output {
      background: #2c3e50;
      color: #ecf0f1;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      padding: 15px;
      border-radius: 6px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .controls {
      text-align: center;
      margin-top: 30px;
    }

    .btn {
      background: #3498db;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin: 0 10px;
      transition: background 0.3s;
    }

    .btn:hover {
      background: #2980b9;
    }

    .btn:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #95a5a6;
    }

    .btn-secondary:hover {
      background: #7f8c8d;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #ecf0f1;
      border-radius: 4px;
      margin: 10px 0;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: #3498db;
      width: 0%;
      transition: width 0.3s;
    }

    .recommendation {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 30px;
      text-align: center;
    }

    .recommendation h3 {
      margin: 0 0 10px 0;
      font-size: 20px;
    }

    .recommendation p {
      margin: 0;
      opacity: 0.9;
    }

    @media (max-width: 768px) {
      .test-content {
        grid-template-columns: 1fr;
      }

      .container {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª VidSlide AI - äººè„¸è·Ÿè¸ªæŠ€æœ¯éªŒè¯</h1>
    <p class="subtitle">éªŒè¯MediaPipe Face Meshå’ŒOpenCV.jsåœ¨æµè§ˆå™¨ä¸­çš„å¯è¡Œæ€§</p>

    <div class="status-panel">
      <div class="status-item">
        <span class="status-label">éªŒè¯çŠ¶æ€</span>
        <span class="status-value status-info" id="overall-status">å‡†å¤‡ä¸­</span>
      </div>
      <div class="status-item">
        <span class="status-label">æµè§ˆå™¨å…¼å®¹æ€§</span>
        <span class="status-value" id="browser-support">æ£€æµ‹ä¸­...</span>
      </div>
      <div class="status-item">
        <span class="status-label">WebAssemblyæ”¯æŒ</span>
        <span class="status-value" id="wasm-support">æ£€æµ‹ä¸­...</span>
      </div>
      <div class="status-item">
        <span class="status-label">å†…å­˜ä½¿ç”¨</span>
        <span class="status-value" id="memory-usage">æ£€æµ‹ä¸­...</span>
      </div>
    </div>

    <div class="test-section">
      <div class="test-header">
        <h2 class="test-title">MediaPipe Face Meshæµ‹è¯•</h2>
        <span class="test-status" id="mediapipe-status">æœªå¼€å§‹</span>
      </div>
      <div class="test-content">
        <div class="metric-card">
          <div class="metric-title">åŠ è½½æ—¶é—´</div>
          <div class="metric-value" id="mediapipe-load-time">-</div>
          <div class="metric-unit">æ¯«ç§’</div>
        </div>
        <div class="metric-card">
          <div class="metric-title">æ¨ç†æ—¶é—´</div>
          <div class="metric-value" id="mediapipe-inference-time">-</div>
          <div class="metric-unit">æ¯«ç§’</div>
        </div>
        <div class="metric-card">
          <div class="metric-title">æ£€æµ‹ç²¾åº¦</div>
          <div class="metric-value" id="mediapipe-accuracy">-</div>
          <div class="metric-unit">å…³é”®ç‚¹</div>
        </div>
        <div class="metric-card">
          <div class="metric-title">å¯ç”¨æ€§</div>
          <div class="metric-value" id="mediapipe-available">-</div>
        </div>
      </div>
    </div>

    <div class="test-section">
      <div class="test-header">
        <h2 class="test-title">OpenCV.jsæµ‹è¯•</h2>
        <span class="test-status" id="opencv-status">æœªå¼€å§‹</span>
      </div>
      <div class="test-content">
        <div class="metric-card">
          <div class="metric-title">åŠ è½½æ—¶é—´</div>
          <div class="metric-value" id="opencv-load-time">-</div>
          <div class="metric-unit">æ¯«ç§’</div>
        </div>
        <div class="metric-card">
          <div class="metric-title">æ¨ç†æ—¶é—´</div>
          <div class="metric-value" id="opencv-inference-time">-</div>
          <div class="metric-unit">æ¯«ç§’</div>
        </div>
        <div class="metric-card">
          <div class="metric-title">æ£€æµ‹ç²¾åº¦</div>
          <div class="metric-value" id="opencv-accuracy">-</div>
          <div class="metric-unit">ç‰¹å¾</div>
        </div>
        <div class="metric-card">
          <div class="metric-title">å¯ç”¨æ€§</div>
          <div class="metric-value" id="opencv-available">-</div>
        </div>
      </div>
    </div>

    <div class="test-section">
      <div class="test-header">
        <h2 class="test-title">æ€§èƒ½å¯¹æ¯”åˆ†æ</h2>
        <span class="test-status" id="comparison-status">æœªå¼€å§‹</span>
      </div>
      <div class="test-content">
        <div class="metric-card">
          <div class="metric-title">å½“å‰å®ç°FPS</div>
          <div class="metric-value" id="current-fps">-</div>
          <div class="metric-unit">å¸§/ç§’</div>
        </div>
        <div class="metric-card">
          <div class="metric-title">MediaPipeä¼˜åŠ¿</div>
          <div class="metric-value" id="mediapipe-advantage">-</div>
          <div class="metric-unit">å€</div>
        </div>
        <div class="metric-card">
          <div class="metric-title">æ¨èæ–¹æ¡ˆ</div>
          <div class="metric-value" id="recommended-solution">-</div>
        </div>
        <div class="metric-card">
          <div class="metric-title">ç½®ä¿¡åº¦</div>
          <div class="metric-value" id="confidence-level">-</div>
          <div class="metric-unit">%</div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="start-test-btn">å¼€å§‹éªŒè¯</button>
      <button class="btn btn-secondary" id="clear-console-btn">æ¸…ç©ºæ§åˆ¶å°</button>
      <button class="btn btn-secondary" id="export-report-btn">å¯¼å‡ºæŠ¥å‘Š</button>
    </div>

    <div class="progress-bar">
      <div class="progress-fill" id="progress-fill"></div>
    </div>

    <div class="recommendation" id="recommendation-panel" style="display: none;">
      <h3 id="recommendation-title">éªŒè¯å®Œæˆ</h3>
      <p id="recommendation-text">æ­£åœ¨ç”Ÿæˆæ¨èæ–¹æ¡ˆ...</p>
    </div>

    <div class="console-output" id="console-output">
      <div>æ§åˆ¶å°è¾“å‡ºå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    </div>
  </div>

  <script type="module">
    import { validateFaceTracking } from './face-tracking-validation.js'

    class ValidationUI {
      constructor() {
        this.results = null
        this.originalConsoleLog = console.log
        this.originalConsoleWarn = console.warn
        this.originalConsoleError = console.error

        this.initUI()
        this.setupConsoleCapture()
        this.checkInitialSupport()
      }

      initUI() {
        this.startBtn = document.getElementById('start-test-btn')
        this.clearBtn = document.getElementById('clear-console-btn')
        this.exportBtn = document.getElementById('export-report-btn')
        this.progressFill = document.getElementById('progress-fill')
        this.consoleOutput = document.getElementById('console-output')
        this.recommendationPanel = document.getElementById('recommendation-panel')

        this.startBtn.addEventListener('click', () => this.startValidation())
        this.clearBtn.addEventListener('click', () => this.clearConsole())
        this.exportBtn.addEventListener('click', () => this.exportReport())
      }

      setupConsoleCapture() {
        const self = this

        console.log = function(...args) {
          self.addToConsole('log', ...args)
          self.originalConsoleLog.apply(console, args)
        }

        console.warn = function(...args) {
          self.addToConsole('warn', ...args)
          self.originalConsoleWarn.apply(console, args)
        }

        console.error = function(...args) {
          self.addToConsole('error', ...args)
          self.originalConsoleError.apply(console, args)
        }
      }

      addToConsole(type, ...args) {
        const timestamp = new Date().toLocaleTimeString()
        const message = args.map(arg =>
          typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
        ).join(' ')

        const line = document.createElement('div')
        line.className = `console-${type}`
        line.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`

        this.consoleOutput.appendChild(line)
        this.consoleOutput.scrollTop = this.consoleOutput.scrollHeight
      }

      checkInitialSupport() {
        // æ£€æŸ¥WebAssemblyæ”¯æŒ
        const wasmSupported = typeof WebAssembly === 'object'
        document.getElementById('wasm-support').textContent = wasmSupported ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'
        document.getElementById('wasm-support').className = `status-value ${wasmSupported ? 'status-success' : 'status-error'}`

        // æ£€æŸ¥æµè§ˆå™¨ç±»å‹
        const userAgent = navigator.userAgent
        let browser = 'æœªçŸ¥'
        if (userAgent.includes('Chrome')) browser = 'Chrome'
        else if (userAgent.includes('Firefox')) browser = 'Firefox'
        else if (userAgent.includes('Safari')) browser = 'Safari'
        else if (userAgent.includes('Edge')) browser = 'Edge'

        document.getElementById('browser-support').textContent = browser

        // æ£€æŸ¥å†…å­˜ä¿¡æ¯
        if (performance.memory) {
          const mem = performance.memory
          const usage = (mem.usedJSHeapSize / mem.jsHeapSizeLimit * 100).toFixed(1)
          document.getElementById('memory-usage').textContent = `${usage}%`
        } else {
          document.getElementById('memory-usage').textContent = 'ä¸å¯ç”¨'
        }
      }

      async startValidation() {
        this.startBtn.disabled = true
        this.startBtn.textContent = 'éªŒè¯ä¸­...'
        document.getElementById('overall-status').textContent = 'è¿›è¡Œä¸­'
        document.getElementById('overall-status').className = 'status-value status-warning'

        try {
          this.updateProgress(10)
          console.log('ğŸš€ å¼€å§‹äººè„¸è·Ÿè¸ªæŠ€æœ¯éªŒè¯...')

          this.updateProgress(30)
          const results = await validateFaceTracking()

          this.results = results
          this.updateProgress(100)

          this.displayResults(results)
          this.showRecommendation(results)

          document.getElementById('overall-status').textContent = 'å®Œæˆ'
          document.getElementById('overall-status').className = 'status-value status-success'

        } catch (error) {
          console.error('éªŒè¯å¤±è´¥:', error)
          document.getElementById('overall-status').textContent = 'å¤±è´¥'
          document.getElementById('overall-status').className = 'status-value status-error'
        } finally {
          this.startBtn.disabled = false
          this.startBtn.textContent = 'é‡æ–°éªŒè¯'
        }
      }

      updateProgress(percent) {
        this.progressFill.style.width = `${percent}%`
      }

      displayResults(results) {
        if (results.error) {
          console.error('éªŒè¯è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', results.error)
          return
        }

        // MediaPipeç»“æœ
        const mp = results.detailedResults.mediapipe
        document.getElementById('mediapipe-load-time').textContent = mp.loadTime > 0 ? mp.loadTime.toFixed(1) : '-'
        document.getElementById('mediapipe-inference-time').textContent = mp.inferenceTime > 0 ? mp.inferenceTime.toFixed(1) : '-'
        document.getElementById('mediapipe-accuracy').textContent = mp.accuracy || '-'
        document.getElementById('mediapipe-available').textContent = mp.available ? 'âœ…' : 'âŒ'
        document.getElementById('mediapipe-status').textContent = mp.available ? 'æˆåŠŸ' : 'å¤±è´¥'
        document.getElementById('mediapipe-status').className = `test-status ${mp.available ? 'status-success' : 'status-error'}`

        // OpenCVç»“æœ
        const ocv = results.detailedResults.opencv
        document.getElementById('opencv-load-time').textContent = ocv.loadTime > 0 ? ocv.loadTime.toFixed(1) : '-'
        document.getElementById('opencv-inference-time').textContent = ocv.inferenceTime > 0 ? ocv.inferenceTime.toFixed(1) : '-'
        document.getElementById('opencv-accuracy').textContent = ocv.accuracy || '-'
        document.getElementById('opencv-available').textContent = ocv.available ? 'âœ…' : 'âŒ'
        document.getElementById('opencv-status').textContent = ocv.available ? 'æˆåŠŸ' : 'å¤±è´¥'
        document.getElementById('opencv-status').className = `test-status ${ocv.available ? 'status-success' : 'status-error'}`

        // å¯¹æ¯”åˆ†æ
        document.getElementById('current-fps').textContent = results.detailedResults.currentImplementation.fps || '0'
        document.getElementById('mediapipe-advantage').textContent = mp.inferenceTime > 0 ? (1000 / mp.inferenceTime).toFixed(1) : '-'
        document.getElementById('recommended-solution').textContent = results.summary.recommendation.split(' - ')[0]
        document.getElementById('confidence-level').textContent = mp.available ? '95' : '30'
        document.getElementById('comparison-status').textContent = 'å®Œæˆ'
        document.getElementById('comparison-status').className = 'test-status status-success'
      }

      showRecommendation(results) {
        const panel = this.recommendationPanel
        const title = document.getElementById('recommendation-title')
        const text = document.getElementById('recommendation-text')

        if (results.summary.recommendation.includes('MediaPipe')) {
          title.textContent = 'ğŸ¯ æ¨èä½¿ç”¨ MediaPipe Face Mesh'
          text.textContent = 'æ€§èƒ½ä¼˜å¼‚ï¼Œç²¾åº¦é«˜ï¼Œæ¨èä½œä¸ºä¸»è¦äººè„¸è·Ÿè¸ªæ–¹æ¡ˆ'
          panel.style.background = 'linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)'
        } else if (results.summary.recommendation.includes('OpenCV')) {
          title.textContent = 'ğŸ”§ å»ºè®®ä½¿ç”¨ OpenCV.js'
          text.textContent = 'åŠŸèƒ½å…¨é¢ï¼Œä½†åŒ…ä½“ç§¯è¾ƒå¤§ï¼Œé€‚åˆå¤æ‚åœºæ™¯'
          panel.style.background = 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)'
        } else {
          title.textContent = 'âš ï¸ éœ€è¦è¿›ä¸€æ­¥è¯„ä¼°'
          text.textContent = 'å½“å‰æ–¹æ¡ˆæš‚ä¸æˆç†Ÿï¼Œå»ºè®®ç­‰å¾…æŠ€æœ¯å‘å±•æˆ–å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆ'
          panel.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)'
        }

        panel.style.display = 'block'
      }

      clearConsole() {
        this.consoleOutput.innerHTML = '<div>æ§åˆ¶å°å·²æ¸…ç©º...</div>'
      }

      exportReport() {
        if (!this.results) {
          alert('è¯·å…ˆè¿è¡ŒéªŒè¯æµ‹è¯•')
          return
        }

        const report = {
          timestamp: new Date().toISOString(),
          userAgent: navigator.userAgent,
          results: this.results
        }

        const blob = new Blob([JSON.stringify(report, null, 2)], {
          type: 'application/json'
        })

        const url = URL.createObjectURL(blob)
        const a = document.createElement('a')
        a.href = url
        a.download = `face-tracking-validation-${Date.now()}.json`
        document.body.appendChild(a)
        a.click()
        document.body.removeChild(a)
        URL.revokeObjectURL(url)
      }
    }

    // åˆå§‹åŒ–UI
    new ValidationUI()

    console.log('ğŸ¬ äººè„¸è·Ÿè¸ªéªŒè¯å·¥å…·å·²å°±ç»ª')
    console.log('ç‚¹å‡»"å¼€å§‹éªŒè¯"æŒ‰é’®å¼€å§‹æµ‹è¯•')
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidSlide AI - æ°´å°ç­–ç•¥æŠ€æœ¯éªŒè¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h2 {
            color: #555;
            margin-bottom: 15px;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056cc;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            max-width: 100%;
            height: auto;
        }
        .watermark-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .watermark-sample {
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 10px;
            background: #fafafa;
        }
        .watermark-sample h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #666;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007aff, #5856d6);
            width: 0%;
            transition: width 0.3s ease;
        }
        .user-tiers {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .tier-card {
            flex: 1;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .tier-free {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }
        .tier-premium {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            color: white;
        }
        .tier-enterprise {
            background: linear-gradient(135deg, #45b7d1, #96c93d);
            color: white;
        }
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .metric {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .metric-value {
            font-size: 18px;
            font-weight: bold;
            color: #007aff;
        }
        .metric-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›¡ï¸ VidSlide AI - æ°´å°ç­–ç•¥æŠ€æœ¯éªŒè¯</h1>

        <!-- Canvasæ–‡å­—æ¸²æŸ“æµ‹è¯• -->
        <div class="test-section">
            <h2>1. Canvasæ–‡å­—æ¸²æŸ“æµ‹è¯•</h2>
            <p>æµ‹è¯•Canvaså¯¹æ–‡å­—å’Œæ°´å°çš„æ¸²æŸ“èƒ½åŠ›</p>

            <canvas id="textRenderCanvas" width="400" height="200"></canvas>
            <br>
            <button onclick="testCanvasTextRendering()">æµ‹è¯•æ–‡å­—æ¸²æŸ“</button>
            <button onclick="testChineseRendering()">æµ‹è¯•ä¸­æ–‡å­—ä½“</button>
            <button onclick="testTransparency()">æµ‹è¯•é€æ˜åº¦</button>

            <div id="textRenderStatus"></div>
            <div id="textRenderResult" class="result" style="display: none;"></div>
        </div>

        <!-- åŠ¨æ€æ°´å°ç”Ÿæˆæµ‹è¯• -->
        <div class="test-section">
            <h2>2. åŠ¨æ€æ°´å°ç”Ÿæˆæµ‹è¯•</h2>
            <p>æµ‹è¯•ä¸åŒä½ç½®å’Œæ ·å¼çš„æ°´å°ç”Ÿæˆ</p>

            <canvas id="watermarkCanvas" width="800" height="600"></canvas>
            <br>
            <button onclick="generateDynamicWatermarks()">ç”ŸæˆåŠ¨æ€æ°´å°</button>
            <button onclick="testWatermarkPositions()">æµ‹è¯•ä½ç½®</button>
            <button onclick="testWatermarkStyles()">æµ‹è¯•æ ·å¼</button>

            <div class="watermark-preview" id="watermarkPreview" style="display: none;">
                <div class="watermark-sample">
                    <h3>å…è´¹ç‰ˆæ°´å°</h3>
                    <canvas id="freeWatermark" width="200" height="50"></canvas>
                </div>
                <div class="watermark-sample">
                    <h3>ä¸“ä¸šç‰ˆæ°´å°</h3>
                    <canvas id="premiumWatermark" width="200" height="50"></canvas>
                </div>
                <div class="watermark-sample">
                    <h3>ä¼ä¸šç‰ˆæ°´å°</h3>
                    <canvas id="enterpriseWatermark" width="200" height="50"></canvas>
                </div>
            </div>

            <div id="watermarkStatus"></div>
            <div id="watermarkResult" class="result" style="display: none;"></div>
        </div>

        <!-- ç”¨æˆ·ç­‰çº§æ£€æµ‹æµ‹è¯• -->
        <div class="test-section">
            <h2>3. ç”¨æˆ·ç­‰çº§æ£€æµ‹æµ‹è¯•</h2>
            <p>æµ‹è¯•ç”¨æˆ·ç­‰çº§è¯†åˆ«å’Œæ°´å°ç­–ç•¥åº”ç”¨</p>

            <div class="user-tiers">
                <div class="tier-card tier-free">
                    <h3>å…è´¹ç‰ˆ</h3>
                    <p>æ˜¾ç¤ºæ°´å°</p>
                </div>
                <div class="tier-card tier-premium">
                    <h3>ä¸“ä¸šç‰ˆ</h3>
                    <p>æ— æ°´å°</p>
                </div>
                <div class="tier-card tier-enterprise">
                    <h3>ä¼ä¸šç‰ˆ</h3>
                    <p>æ— æ°´å°</p>
                </div>
            </div>

            <button onclick="testUserTierDetection()">æµ‹è¯•ç­‰çº§æ£€æµ‹</button>
            <button onclick="simulateUserSwitching()">æ¨¡æ‹Ÿç”¨æˆ·åˆ‡æ¢</button>

            <div id="userTierStatus"></div>
            <div id="userTierResult" class="result" style="display: none;"></div>
        </div>

        <!-- æ€§èƒ½å½±å“æµ‹è¯• -->
        <div class="test-section">
            <h2>4. æ€§èƒ½å½±å“æµ‹è¯•</h2>
            <p>æµ‹è¯•æ°´å°æ¸²æŸ“å¯¹æ€§èƒ½çš„å½±å“</p>

            <div class="performance-metrics">
                <div class="metric">
                    <div class="metric-value" id="avgRenderTime">--</div>
                    <div class="metric-label">å¹³å‡æ¸²æŸ“æ—¶é—´</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="maxRenderTime">--</div>
                    <div class="metric-label">æœ€å¤§æ¸²æŸ“æ—¶é—´</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="memoryUsage">--</div>
                    <div class="metric-label">å†…å­˜ä½¿ç”¨</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="performanceStatus">--</div>
                    <div class="metric-label">æ€§èƒ½çŠ¶æ€</div>
                </div>
            </div>

            <button onclick="testPerformanceImpact()">æµ‹è¯•æ€§èƒ½å½±å“</button>
            <button onclick="runPerformanceBenchmark()">è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•</button>

            <div class="progress">
                <div class="progress-fill" id="performanceProgress"></div>
            </div>

            <div id="performanceStatus"></div>
            <div id="performanceResult" class="result" style="display: none;"></div>
        </div>

        <!-- å®Œæ•´éªŒè¯æµ‹è¯• -->
        <div class="test-section">
            <h2>5. å®Œæ•´æŠ€æœ¯éªŒè¯</h2>
            <p>è¿è¡Œå®Œæ•´çš„è‡ªåŠ¨åŒ–éªŒè¯å¥—ä»¶</p>

            <button onclick="runFullValidation()" id="fullValidationBtn">è¿è¡Œå®Œæ•´éªŒè¯</button>

            <div class="progress">
                <div class="progress-fill" id="fullValidationProgress"></div>
            </div>

            <div id="fullValidationStatus"></div>
            <div id="fullValidationResult" class="result" style="display: none;"></div>
        </div>

        <!-- æµ‹è¯•æ€»ç»“ -->
        <div class="test-section">
            <h2>6. æµ‹è¯•æ€»ç»“</h2>
            <div id="overallStatus"></div>
            <button onclick="generateReport()">ç”ŸæˆéªŒè¯æŠ¥å‘Š</button>
        </div>
    </div>

    <script type="module">
        import { validateWatermarkCapabilities } from './src/utils/watermark-validation.js';

        let validationResults = null;

        // Canvasæ–‡å­—æ¸²æŸ“æµ‹è¯•
        window.testCanvasTextRendering = function() {
            const canvas = document.getElementById('textRenderCanvas');
            const ctx = canvas.getContext('2d');
            const statusDiv = document.getElementById('textRenderStatus');
            const resultDiv = document.getElementById('textRenderResult');

            try {
                // æ¸…ç©ºç”»å¸ƒ
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ç»˜åˆ¶èƒŒæ™¯
                ctx.fillStyle = '#f0f0f0';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // æµ‹è¯•åŸºç¡€æ–‡å­—æ¸²æŸ“
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.font = '18px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('Canvasæ–‡å­—æ¸²æŸ“æµ‹è¯•', 20, 40);

                // æµ‹è¯•ä¸åŒæ ·å¼
                ctx.fillStyle = 'rgba(255, 0, 0, 0.7)';
                ctx.font = 'italic 16px Georgia';
                ctx.fillText('æ ·å¼æµ‹è¯•: æ–œä½“çº¢è‰²', 20, 70);

                ctx.fillStyle = 'rgba(0, 100, 0, 0.8)';
                ctx.font = 'bold 14px Verdana';
                ctx.fillText('æ ·å¼æµ‹è¯•: ç²—ä½“ç»¿è‰²', 20, 100);

                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… Canvasæ–‡å­—æ¸²æŸ“æµ‹è¯•æˆåŠŸ';
                resultDiv.style.display = 'block';
                resultDiv.textContent = 'Canvasæ–‡å­—æ¸²æŸ“åŠŸèƒ½æ­£å¸¸:\n- åŸºç¡€æ–‡å­—æ¸²æŸ“: âœ“\n- æ ·å¼æ§åˆ¶: âœ“\n- é¢œè‰²å’Œé€æ˜åº¦: âœ“';

            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ æ–‡å­—æ¸²æŸ“æµ‹è¯•å¤±è´¥: ${error.message}`;
                resultDiv.style.display = 'none';
            }
        };

        window.testChineseRendering = function() {
            const canvas = document.getElementById('textRenderCanvas');
            const ctx = canvas.getContext('2d');

            try {
                ctx.fillStyle = 'rgba(0, 0, 255, 0.8)';
                ctx.font = '20px "Microsoft YaHei", "SimHei", sans-serif';
                ctx.fillText('ä¸­æ–‡å­—ä½“æ¸²æŸ“æµ‹è¯•', 20, 140);

                ctx.font = '16px Arial, sans-serif';
                ctx.fillStyle = 'rgba(100, 0, 100, 0.8)';
                ctx.fillText('Fallbackå­—ä½“æµ‹è¯•', 20, 170);

                document.getElementById('textRenderStatus').textContent = 'âœ… ä¸­æ–‡å­—ä½“æ¸²æŸ“æµ‹è¯•æˆåŠŸ';

            } catch (error) {
                document.getElementById('textRenderStatus').className = 'status error';
                document.getElementById('textRenderStatus').textContent = `âŒ ä¸­æ–‡å­—ä½“æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        };

        window.testTransparency = function() {
            const canvas = document.getElementById('textRenderCanvas');
            const ctx = canvas.getContext('2d');

            try {
                // åˆ›å»ºåŠé€æ˜æ°´å°æ•ˆæœ
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.fillRect(250, 20, 130, 160);

                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.font = '14px Arial';
                ctx.fillText('é€æ˜åº¦: 30%', 260, 50);

                ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
                ctx.fillText('é€æ˜åº¦: 60%', 260, 80);

                ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
                ctx.fillText('é€æ˜åº¦: 90%', 260, 110);

                document.getElementById('textRenderStatus').textContent = 'âœ… é€æ˜åº¦æ§åˆ¶æµ‹è¯•æˆåŠŸ';

            } catch (error) {
                document.getElementById('textRenderStatus').className = 'status error';
                document.getElementById('textRenderStatus').textContent = `âŒ é€æ˜åº¦æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        };

        // åŠ¨æ€æ°´å°ç”Ÿæˆæµ‹è¯•
        window.generateDynamicWatermarks = function() {
            const canvas = document.getElementById('watermarkCanvas');
            const ctx = canvas.getContext('2d');

            try {
                // æ¸…ç©ºç”»å¸ƒ
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // ç»˜åˆ¶èƒŒæ™¯å›¾ç‰‡æ¨¡æ‹Ÿ
                ctx.fillStyle = '#e8f4f8';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // ç»˜åˆ¶æ¨¡æ‹Ÿå†…å®¹
                ctx.fillStyle = '#333';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('æ¼”ç¤ºæ–‡ç¨¿å†…å®¹', canvas.width / 2, canvas.height / 2);

                // æ·»åŠ æ°´å°
                addWatermark(ctx, canvas.width, canvas.height, 'VidSlide AI æ¼”ç¤º', 'bottom-right');
                addWatermark(ctx, canvas.width, canvas.height, 'å…è´¹ç‰ˆæ°´å°', 'top-left', 0.5);

                document.getElementById('watermarkStatus').className = 'status success';
                document.getElementById('watermarkStatus').textContent = 'âœ… åŠ¨æ€æ°´å°ç”ŸæˆæˆåŠŸ';

            } catch (error) {
                document.getElementById('watermarkStatus').className = 'status error';
                document.getElementById('watermarkStatus').textContent = `âŒ æ°´å°ç”Ÿæˆå¤±è´¥: ${error.message}`;
            }
        };

        window.testWatermarkPositions = function() {
            const canvas = document.getElementById('watermarkCanvas');
            const ctx = canvas.getContext('2d');

            const positions = ['top-left', 'top-right', 'center', 'bottom-left', 'bottom-right'];

            positions.forEach((position, index) => {
                addWatermark(ctx, canvas.width, canvas.height, position, position, 0.7);
            });

            document.getElementById('watermarkStatus').textContent = 'âœ… æ°´å°ä½ç½®æµ‹è¯•å®Œæˆ';
        };

        window.testWatermarkStyles = function() {
            // æ˜¾ç¤ºæ°´å°æ ·å¼é¢„è§ˆ
            document.getElementById('watermarkPreview').style.display = 'grid';

            // å…è´¹ç‰ˆæ°´å°
            const freeCanvas = document.getElementById('freeWatermark');
            const freeCtx = freeCanvas.getContext('2d');
            freeCtx.fillStyle = 'rgba(255, 0, 0, 0.8)';
            freeCtx.font = '14px Arial';
            freeCtx.fillText('VidSlide AI - å…è´¹ç‰ˆ', 10, 30);

            // ä¸“ä¸šç‰ˆæ°´å°
            const premiumCanvas = document.getElementById('premiumWatermark');
            const premiumCtx = premiumCanvas.getContext('2d');
            premiumCtx.fillStyle = 'rgba(0, 100, 255, 0.6)';
            premiumCtx.font = '12px Arial';
            premiumCtx.fillText('VidSlide AI - ä¸“ä¸šç‰ˆ', 10, 30);

            // ä¼ä¸šç‰ˆæ°´å°
            const enterpriseCanvas = document.getElementById('enterpriseWatermark');
            const enterpriseCtx = enterpriseCanvas.getContext('2d');
            enterpriseCtx.fillStyle = 'rgba(0, 150, 0, 0.5)';
            enterpriseCtx.font = '16px Arial';
            enterpriseCtx.fillText('VidSlide AI - ä¼ä¸šç‰ˆ', 10, 30);
        };

        // ç”¨æˆ·ç­‰çº§æ£€æµ‹æµ‹è¯•
        window.testUserTierDetection = function() {
            const statusDiv = document.getElementById('userTierStatus');
            const resultDiv = document.getElementById('userTierResult');

            try {
                // æ¨¡æ‹Ÿç”¨æˆ·ç­‰çº§æ£€æµ‹
                const users = [
                    { id: 1, subscription: 'free' },
                    { id: 2, subscription: 'premium' },
                    { id: 3, subscription: 'enterprise' }
                ];

                const results = users.map(user => {
                    const hasWatermark = user.subscription === 'free';
                    const watermarkText = hasWatermark ? 'VidSlide AI - å…è´¹ç‰ˆ' : null;
                    return {
                        userId: user.id,
                        tier: user.subscription,
                        hasWatermark,
                        watermarkText
                    };
                });

                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… ç”¨æˆ·ç­‰çº§æ£€æµ‹æµ‹è¯•æˆåŠŸ';

                resultDiv.style.display = 'block';
                resultDiv.textContent = 'ç”¨æˆ·ç­‰çº§æ£€æµ‹ç»“æœ:\n' +
                    results.map(r => `ç”¨æˆ·${r.userId} (${r.tier}): ${r.hasWatermark ? 'æ˜¾ç¤ºæ°´å°' : 'æ— æ°´å°'}`).join('\n');

            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ ç­‰çº§æ£€æµ‹æµ‹è¯•å¤±è´¥: ${error.message}`;
                resultDiv.style.display = 'none';
            }
        };

        window.simulateUserSwitching = function() {
            const tiers = ['free', 'premium', 'enterprise'];
            let currentIndex = 0;

            const interval = setInterval(() => {
                const tier = tiers[currentIndex];
                document.querySelectorAll('.tier-card').forEach(card => {
                    card.style.opacity = '0.3';
                });

                const activeCard = document.querySelector(`.tier-${tier}`);
                if (activeCard) {
                    activeCard.style.opacity = '1';
                    activeCard.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        activeCard.style.transform = 'scale(1)';
                    }, 200);
                }

                currentIndex = (currentIndex + 1) % tiers.length;

                if (currentIndex === 0) {
                    clearInterval(interval);
                    document.querySelectorAll('.tier-card').forEach(card => {
                        card.style.opacity = '1';
                    });
                }
            }, 1000);
        };

        // æ€§èƒ½å½±å“æµ‹è¯•
        window.testPerformanceImpact = async function() {
            const progressFill = document.getElementById('performanceProgress');
            const statusDiv = document.getElementById('performanceStatus');

            statusDiv.className = 'status info';
            statusDiv.textContent = 'æ­£åœ¨æµ‹è¯•æ€§èƒ½å½±å“...';

            try {
                const canvas = document.createElement('canvas');
                canvas.width = 1920;
                canvas.height = 1080;
                const ctx = canvas.getContext('2d');

                // é¢„çƒ­
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, 1920, 1080);

                // æµ‹è¯•æ°´å°æ¸²æŸ“æ€§èƒ½
                const testCount = 50;
                const renderTimes = [];

                for (let i = 0; i < testCount; i++) {
                    const startTime = performance.now();

                    // æ¸²æŸ“æ°´å°
                    ctx.save();
                    ctx.globalAlpha = 0.7;
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.font = '24px Arial';
                    ctx.textAlign = 'right';
                    ctx.textBaseline = 'bottom';
                    ctx.fillText('VidSlide AI æ€§èƒ½æµ‹è¯•æ°´å°', 1900, 1060);
                    ctx.restore();

                    const endTime = performance.now();
                    renderTimes.push(endTime - startTime);

                    // æ›´æ–°è¿›åº¦
                    progressFill.style.width = ((i + 1) / testCount * 100) + '%';
                }

                const avgTime = renderTimes.reduce((a, b) => a + b, 0) / testCount;
                const maxTime = Math.max(...renderTimes);

                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('avgRenderTime').textContent = avgTime.toFixed(2) + 'ms';
                document.getElementById('maxRenderTime').textContent = maxTime.toFixed(2) + 'ms';

                if (performance.memory) {
                    const memoryMB = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
                    document.getElementById('memoryUsage').textContent = memoryMB + 'MB';
                }

                const isAcceptable = avgTime < 50;
                document.getElementById('performanceStatus').textContent = isAcceptable ? 'è‰¯å¥½' : 'éœ€è¦ä¼˜åŒ–';
                document.getElementById('performanceStatus').style.color = isAcceptable ? '#28a745' : '#dc3545';

                statusDiv.className = 'status success';
                statusDiv.textContent = `âœ… æ€§èƒ½æµ‹è¯•å®Œæˆ - å¹³å‡æ¸²æŸ“æ—¶é—´: ${avgTime.toFixed(2)}ms`;

            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ æ€§èƒ½æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        };

        window.runPerformanceBenchmark = function() {
            // è¿è¡Œæ›´å…¨é¢çš„æ€§èƒ½åŸºå‡†æµ‹è¯•
            const startTime = performance.now();

            // æ¨¡æ‹Ÿå¤§é‡æ°´å°æ¸²æŸ“
            for (let i = 0; i < 1000; i++) {
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 100;
                const ctx = canvas.getContext('2d');

                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.font = '12px Arial';
                ctx.fillText('åŸºå‡†æµ‹è¯•æ°´å°', 150, 80);
            }

            const endTime = performance.now();
            const duration = endTime - startTime;

            document.getElementById('performanceStatus').textContent = `åŸºå‡†æµ‹è¯•å®Œæˆ: ${duration.toFixed(2)}ms`;
        };

        // å®Œæ•´éªŒè¯æµ‹è¯•
        window.runFullValidation = async function() {
            const btn = document.getElementById('fullValidationBtn');
            const progressFill = document.getElementById('fullValidationProgress');
            const statusDiv = document.getElementById('fullValidationStatus');
            const resultDiv = document.getElementById('fullValidationResult');

            btn.disabled = true;
            btn.textContent = 'éªŒè¯ä¸­...';
            statusDiv.className = 'status info';
            statusDiv.textContent = 'æ­£åœ¨è¿è¡Œå®Œæ•´éªŒè¯å¥—ä»¶...';
            progressFill.style.width = '0%';

            try {
                // æ›´æ–°è¿›åº¦
                const updateProgress = (percent) => {
                    progressFill.style.width = percent + '%';
                };

                updateProgress(10);
                await new Promise(resolve => setTimeout(resolve, 200));

                updateProgress(30);
                await new Promise(resolve => setTimeout(resolve, 200));

                updateProgress(50);
                await new Promise(resolve => setTimeout(resolve, 200));

                updateProgress(70);
                // è¿è¡Œå®é™…éªŒè¯
                validationResults = await validateWatermarkCapabilities();

                updateProgress(100);

                // æ˜¾ç¤ºç»“æœ
                const overallStatus = validationResults.overallStatus;
                if (overallStatus === 'passed') {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = 'ğŸ‰ å®Œæ•´éªŒè¯é€šè¿‡ï¼æ°´å°åŠŸèƒ½æŠ€æœ¯å¯è¡Œ';
                } else if (overallStatus === 'warning') {
                    statusDiv.className = 'status warning';
                    statusDiv.textContent = 'âš ï¸ éªŒè¯å®Œæˆï¼Œä½†å­˜åœ¨ä¸€äº›æ€§èƒ½è€ƒè™‘';
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = 'âŒ éªŒè¯å¤±è´¥ï¼Œå­˜åœ¨æŠ€æœ¯éšœç¢';
                }

                resultDiv.style.display = 'block';
                resultDiv.textContent = 'å®Œæ•´éªŒè¯ç»“æœ:\n' + JSON.stringify(validationResults, null, 2);

                updateOverallStatus();

            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ éªŒè¯å¤±è´¥: ${error.message}`;
                resultDiv.style.display = 'none';
                console.error('Validation failed:', error);
            } finally {
                btn.disabled = false;
                btn.textContent = 'è¿è¡Œå®Œæ•´éªŒè¯';
            }
        };

        window.generateReport = function() {
            if (!validationResults) {
                alert('è¯·å…ˆè¿è¡Œå®Œæ•´éªŒè¯');
                return;
            }

            const report = `
VidSlide AI - æ°´å°ç­–ç•¥æŠ€æœ¯éªŒè¯æŠ¥å‘Š
====================================

éªŒè¯æ—¶é—´: ${new Date().toLocaleString()}
éªŒè¯çŠ¶æ€: ${validationResults.overallStatus.toUpperCase()}

è¯¦ç»†ç»“æœ:
${Object.entries(validationResults)
    .filter(([key]) => key !== 'overallStatus')
    .map(([key, result]) => `- ${result.name}: ${result.status.toUpperCase()}`)
    .join('\n')}

å»ºè®®:
- ${validationResults.overallStatus === 'passed' ?
    'æ°´å°åŠŸèƒ½å¯ä»¥æ­£å¸¸å®ç°ï¼Œå»ºè®®ç«‹å³å¼€å§‹å¼€å‘' :
    'éœ€è¦é‡æ–°è¯„ä¼°æ°´å°å®ç°ç­–ç•¥æˆ–å¯»æ‰¾å¤‡é€‰æ–¹æ¡ˆ'}
`;

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'watermark-validation-report.txt';
            a.textContent = 'ä¸‹è½½éªŒè¯æŠ¥å‘Š';
            a.style.marginLeft = '10px';
            a.style.color = '#007aff';
            a.style.textDecoration = 'underline';
            a.style.cursor = 'pointer';

            const statusDiv = document.getElementById('overallStatus');
            statusDiv.appendChild(a);
        };

        // è¾…åŠ©å‡½æ•°
        function addWatermark(ctx, canvasWidth, canvasHeight, text, position, opacity = 0.8) {
            ctx.save();
            ctx.globalAlpha = opacity;
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.font = '16px Arial';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'bottom';

            const textWidth = ctx.measureText(text).width;
            const textHeight = 20;
            const margin = 20;

            let x, y;
            switch (position) {
                case 'top-left':
                    x = margin;
                    y = margin + textHeight;
                    ctx.textAlign = 'left';
                    break;
                case 'top-right':
                    x = canvasWidth - margin;
                    y = margin + textHeight;
                    break;
                case 'bottom-left':
                    x = margin;
                    y = canvasHeight - margin;
                    ctx.textAlign = 'left';
                    break;
                case 'bottom-right':
                    x = canvasWidth - margin;
                    y = canvasHeight - margin;
                    break;
                case 'center':
                    x = canvasWidth / 2;
                    y = canvasHeight / 2;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    break;
                default:
                    x = canvasWidth - margin;
                    y = canvasHeight - margin;
            }

            ctx.fillText(text, x, y);
            ctx.restore();
        }

        function updateOverallStatus() {
            const statusDiv = document.getElementById('overallStatus');

            if (!validationResults) {
                statusDiv.className = 'status info';
                statusDiv.textContent = 'ç­‰å¾…å®Œæ•´éªŒè¯å®Œæˆ...';
                return;
            }

            const passedCount = Object.values(validationResults)
                .filter(result => typeof result === 'object' && result.status === 'passed').length;
            const totalCount = Object.keys(validationResults)
                .filter(key => key !== 'overallStatus').length;

            if (validationResults.overallStatus === 'passed') {
                statusDiv.className = 'status success';
                statusDiv.textContent = `ğŸ‰ æ°´å°åŠŸèƒ½éªŒè¯æˆåŠŸ! (${passedCount}/${totalCount}é¡¹é€šè¿‡)`;
            } else if (validationResults.overallStatus === 'warning') {
                statusDiv.className = 'status warning';
                statusDiv.textContent = `âš ï¸ éªŒè¯å®Œæˆï¼Œæœ‰æ€§èƒ½è€ƒè™‘ (${passedCount}/${totalCount}é¡¹é€šè¿‡)`;
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ éªŒè¯å¤±è´¥ï¼Œå­˜åœ¨æŠ€æœ¯éšœç¢ (${passedCount}/${totalCount}é¡¹é€šè¿‡)`;
            }
        }

        // åˆå§‹åŒ–
        updateOverallStatus();
    </script>
</body>
</html>
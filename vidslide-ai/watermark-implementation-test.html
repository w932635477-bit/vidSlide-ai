<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VidSlide AI - æ°´å°åŠŸèƒ½å®ç°æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h2 {
            color: #555;
            margin-bottom: 15px;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056cc;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            max-width: 100%;
            height: auto;
        }
        .user-tier-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .tier-button {
            padding: 8px 16px;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .tier-button.active {
            border-color: #007aff;
            background: #007aff;
            color: white;
        }
        .tier-button:hover {
            border-color: #007aff;
        }
        .watermark-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .preview-item {
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 15px;
            background: #fafafa;
        }
        .preview-item h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #333;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .export-result {
            margin-top: 15px;
            padding: 15px;
            background: #e8f8e8;
            border: 1px solid #c8e8c8;
            border-radius: 6px;
        }
        .export-result h3 {
            margin: 0 0 10px 0;
            color: #2d5a2d;
        }
        .export-actions {
            margin-top: 10px;
        }
        .export-actions button {
            margin-right: 10px;
            padding: 6px 12px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›¡ï¸ VidSlide AI - æ°´å°åŠŸèƒ½å®ç°æµ‹è¯•</h1>

        <!-- ç”¨æˆ·ç­‰çº§è®¾ç½® -->
        <div class="test-section">
            <h2>1. ç”¨æˆ·ç­‰çº§è®¾ç½®</h2>
            <p>æµ‹è¯•ä¸åŒç”¨æˆ·ç­‰çº§çš„æ°´å°ç­–ç•¥</p>

            <div class="user-tier-controls">
                <button class="tier-button" onclick="setUserTier('free')">å…è´¹ç‰ˆ</button>
                <button class="tier-button" onclick="setUserTier('premium')">ä¸“ä¸šç‰ˆ</button>
                <button class="tier-button" onclick="setUserTier('enterprise')">ä¼ä¸šç‰ˆ</button>
            </div>

            <div id="userTierStatus"></div>
            <div id="userTierResult" class="result" style="display: none;"></div>
        </div>

        <!-- æ°´å°ç”Ÿæˆå™¨æµ‹è¯• -->
        <div class="test-section">
            <h2>2. æ°´å°ç”Ÿæˆå™¨æµ‹è¯•</h2>
            <p>æµ‹è¯•Canvasæ°´å°æ¸²æŸ“åŠŸèƒ½</p>

            <canvas id="watermarkCanvas" width="600" height="400"></canvas>
            <br>
            <button onclick="testCanvasWatermark()">åº”ç”¨Canvasæ°´å°</button>
            <button onclick="clearCanvas()">æ¸…é™¤ç”»å¸ƒ</button>

            <div id="watermarkStatus"></div>
            <div id="watermarkResult" class="result" style="display: none;"></div>
        </div>

        <!-- æ°´å°é¢„è§ˆ -->
        <div class="test-section">
            <h2>3. æ°´å°æ ·å¼é¢„è§ˆ</h2>
            <p>é¢„è§ˆä¸åŒç”¨æˆ·ç­‰çº§çš„æ°´å°æ ·å¼</p>

            <div class="watermark-preview">
                <div class="preview-item">
                    <h3>å…è´¹ç‰ˆæ°´å°</h3>
                    <canvas id="freePreview" width="200" height="60"></canvas>
                </div>
                <div class="preview-item">
                    <h3>ä¸“ä¸šç‰ˆæ°´å°</h3>
                    <div style="width: 200px; height: 60px; background: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #999; font-size: 12px;">æ— æ°´å°</div>
                </div>
                <div class="preview-item">
                    <h3>ä¼ä¸šç‰ˆæ°´å°</h3>
                    <div style="width: 200px; height: 60px; background: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #999; font-size: 12px;">æ— æ°´å°</div>
                </div>
            </div>

            <button onclick="updateWatermarkPreviews()">æ›´æ–°é¢„è§ˆ</button>

            <div id="previewStatus"></div>
        </div>

        <!-- è§†é¢‘å¯¼å‡ºæ°´å°æµ‹è¯• -->
        <div class="test-section">
            <h2>4. è§†é¢‘å¯¼å‡ºæ°´å°æµ‹è¯•</h2>
            <p>æµ‹è¯•å¸¦æ°´å°çš„è§†é¢‘å¯¼å‡ºåŠŸèƒ½</p>

            <canvas id="videoExportCanvas" width="640" height="360"></canvas>
            <br>
            <button onclick="prepareVideoCanvas()">å‡†å¤‡è§†é¢‘å†…å®¹</button>
            <button onclick="testVideoExportWithWatermark()">å¯¼å‡ºå¸¦æ°´å°è§†é¢‘</button>
            <button onclick="testVideoExportWithoutWatermark()">å¯¼å‡ºæ— æ°´å°è§†é¢‘</button>

            <div id="videoExportStatus"></div>
            <div id="videoExportResult" class="export-result" style="display: none;"></div>
        </div>

        <!-- HTMLå¯¼å‡ºæ°´å°æµ‹è¯• -->
        <div class="test-section">
            <h2>5. HTMLå¯¼å‡ºæ°´å°æµ‹è¯•</h2>
            <p>æµ‹è¯•å¸¦æ°´å°çš„HTMLæ¼”ç¤ºæ–‡ç¨¿å¯¼å‡º</p>

            <button onclick="testHtmlExportWithWatermark()">å¯¼å‡ºå¸¦æ°´å°HTML</button>
            <button onclick="testHtmlExportWithoutWatermark()">å¯¼å‡ºæ— æ°´å°HTML</button>

            <div id="htmlExportStatus"></div>
            <div id="htmlExportResult" class="export-result" style="display: none;"></div>
        </div>

        <!-- å®Œæ•´åŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <h2>6. å®Œæ•´åŠŸèƒ½éªŒè¯</h2>
            <p>è¿è¡Œå®Œæ•´çš„è‡ªåŠ¨åŒ–åŠŸèƒ½éªŒè¯</p>

            <button onclick="runCompleteTest()" id="completeTestBtn">è¿è¡Œå®Œæ•´æµ‹è¯•</button>

            <div id="completeTestStatus"></div>
            <div id="completeTestResult" class="result" style="display: none;"></div>
        </div>

        <!-- æµ‹è¯•æ€»ç»“ -->
        <div class="test-section">
            <h2>7. æµ‹è¯•æ€»ç»“</h2>
            <div id="overallStatus"></div>
        </div>
    </div>

    <script type="module">
        import { getWatermarkGenerator } from './src/utils/WatermarkGenerator.js';
        import { VideoExporter } from './src/utils/videoExporter.js';
        import { HtmlExporter } from './src/utils/htmlExporter.js';

        let watermarkGenerator = null;
        let videoExporter = null;
        let htmlExporter = null;

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            watermarkGenerator = getWatermarkGenerator();
            videoExporter = new VideoExporter();
            htmlExporter = new HtmlExporter();

            updateUserTierDisplay();
            updateWatermarkPreviews();
        });

        // ç”¨æˆ·ç­‰çº§è®¾ç½®
        window.setUserTier = function(tier) {
            watermarkGenerator.setUserTier(tier);
            updateUserTierDisplay();
            updateWatermarkPreviews();

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tier-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        };

        function updateUserTierDisplay() {
            const config = watermarkGenerator.getCurrentConfig();
            const statusDiv = document.getElementById('userTierStatus');
            const resultDiv = document.getElementById('userTierResult');

            statusDiv.className = 'status success';
            statusDiv.textContent = `âœ… å½“å‰ç”¨æˆ·ç­‰çº§: ${config.userTier.toUpperCase()}`;

            resultDiv.style.display = 'block';
            resultDiv.textContent = `ç”¨æˆ·ç­‰çº§é…ç½®:\n` +
                `- ç­‰çº§: ${config.userTier}\n` +
                `- æ˜¾ç¤ºæ°´å°: ${config.showWatermark ? 'æ˜¯' : 'å¦'}\n` +
                `- æ°´å°æ–‡æœ¬: ${config.watermarkText || 'æ— '}\n` +
                `- é€æ˜åº¦: ${config.opacity}\n` +
                `- æè¿°: ${watermarkGenerator.getUserTierDescription()}`;
        }

        // Canvasæ°´å°æµ‹è¯•
        window.testCanvasWatermark = function() {
            const canvas = document.getElementById('watermarkCanvas');
            const ctx = canvas.getContext('2d');
            const statusDiv = document.getElementById('watermarkStatus');
            const resultDiv = document.getElementById('watermarkResult');

            try {
                // ç»˜åˆ¶èƒŒæ™¯å†…å®¹
                ctx.fillStyle = '#e8f4f8';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // ç»˜åˆ¶ä¸€äº›ç¤ºä¾‹å†…å®¹
                ctx.fillStyle = '#333';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('VidSlide AI æ¼”ç¤ºå†…å®¹', canvas.width / 2, canvas.height / 2);

                ctx.fillStyle = '#666';
                ctx.font = '16px Arial';
                ctx.fillText('è¿™æ˜¯æ¼”ç¤ºç”¨çš„ç¤ºä¾‹å†…å®¹', canvas.width / 2, canvas.height / 2 + 40);

                // åº”ç”¨æ°´å°
                watermarkGenerator.applyToCanvas(canvas);

                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… Canvasæ°´å°åº”ç”¨æˆåŠŸ';
                resultDiv.style.display = 'block';
                resultDiv.textContent = 'Canvasæ°´å°æµ‹è¯•ç»“æœ:\n- èƒŒæ™¯å†…å®¹: å·²ç»˜åˆ¶\n- æ°´å°åº”ç”¨: å·²å®Œæˆ\n- æ¸²æŸ“æ•ˆæœ: è¯·æŸ¥çœ‹ä¸Šæ–¹ç”»å¸ƒ';

            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ Canvasæ°´å°æµ‹è¯•å¤±è´¥: ${error.message}`;
                resultDiv.style.display = 'none';
            }
        };

        window.clearCanvas = function() {
            const canvas = document.getElementById('watermarkCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            document.getElementById('watermarkStatus').className = 'status info';
            document.getElementById('watermarkStatus').textContent = 'ç”»å¸ƒå·²æ¸…é™¤';
        };

        // æ°´å°é¢„è§ˆæ›´æ–°
        window.updateWatermarkPreviews = function() {
            const config = watermarkGenerator.getCurrentConfig();

            // å…è´¹ç‰ˆé¢„è§ˆ
            const freeCanvas = document.getElementById('freePreview');
            if (config.userTier === 'free' && config.showWatermark) {
                const ctx = freeCanvas.getContext('2d');
                ctx.clearRect(0, 0, freeCanvas.width, freeCanvas.height);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.font = '12px Arial';
                ctx.fillText(config.watermarkText, 10, 35);
            }

            document.getElementById('previewStatus').className = 'status success';
            document.getElementById('previewStatus').textContent = 'âœ… æ°´å°é¢„è§ˆå·²æ›´æ–°';
        };

        // è§†é¢‘å¯¼å‡ºæµ‹è¯•
        window.prepareVideoCanvas = function() {
            const canvas = document.getElementById('videoExportCanvas');
            const ctx = canvas.getContext('2d');

            // åˆ›å»ºæ¸å˜èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');

            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶å†…å®¹
            ctx.fillStyle = 'white';
            ctx.font = 'bold 32px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('VidSlide AI', canvas.width / 2, canvas.height / 2 - 20);

            ctx.font = '18px Arial';
            ctx.fillText('è§†é¢‘å¯¼å‡ºæµ‹è¯•', canvas.width / 2, canvas.height / 2 + 20);

            // ç»˜åˆ¶ä¸€äº›å›¾å½¢
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.fillRect(50, 50, 100, 60);
            ctx.fillRect(canvas.width - 150, canvas.height - 110, 100, 60);

            document.getElementById('videoExportStatus').className = 'status success';
            document.getElementById('videoExportStatus').textContent = 'âœ… è§†é¢‘å†…å®¹å·²å‡†å¤‡';
        };

        window.testVideoExportWithWatermark = async function() {
            await testVideoExport(true);
        };

        window.testVideoExportWithoutWatermark = async function() {
            await testVideoExport(false);
        };

        async function testVideoExport(applyWatermark) {
            const statusDiv = document.getElementById('videoExportStatus');
            const resultDiv = document.getElementById('videoExportResult');

            statusDiv.className = 'status info';
            statusDiv.textContent = `æ­£åœ¨å¯¼å‡º${applyWatermark ? 'å¸¦æ°´å°' : 'æ— æ°´å°'}è§†é¢‘...`;

            try {
                const canvas = document.getElementById('videoExportCanvas');
                const result = await videoExporter.exportVideo({
                    canvas,
                    duration: 3, // 3ç§’æµ‹è¯•è§†é¢‘
                    frameRate: 30,
                    applyWatermark,
                    onProgress: (progress) => {
                        statusDiv.textContent = `å¯¼å‡ºè¿›åº¦: ${progress.message}`;
                    }
                });

                statusDiv.className = 'status success';
                statusDiv.textContent = `âœ… ${applyWatermark ? 'å¸¦æ°´å°' : 'æ— æ°´å°'}è§†é¢‘å¯¼å‡ºæˆåŠŸ`;

                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <h3>è§†é¢‘å¯¼å‡ºç»“æœ</h3>
                    <p><strong>æ°´å°çŠ¶æ€:</strong> ${applyWatermark ? 'å·²åº”ç”¨' : 'æœªåº”ç”¨'}</p>
                    <p><strong>æ–‡ä»¶å¤§å°:</strong> ${(result.size / 1024).toFixed(1)} KB</p>
                    <p><strong>æ–‡ä»¶ç±»å‹:</strong> ${result.type}</p>
                    <p><strong>é¢„ä¼°æ—¶é•¿:</strong> ${result.duration.toFixed(1)}ç§’</p>
                    <div class="export-actions">
                        <button onclick="downloadVideo('${URL.createObjectURL(result.blob)}', 'test-video-${applyWatermark ? 'watermark' : 'no-watermark'}.webm')">
                            ä¸‹è½½è§†é¢‘
                        </button>
                    </div>
                `;

            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ è§†é¢‘å¯¼å‡ºå¤±è´¥: ${error.message}`;
                resultDiv.style.display = 'none';
            }
        }

        // HTMLå¯¼å‡ºæµ‹è¯•
        window.testHtmlExportWithWatermark = async function() {
            await testHtmlExport(true);
        };

        window.testHtmlExportWithoutWatermark = async function() {
            await testHtmlExport(false);
        };

        async function testHtmlExport(applyWatermark) {
            const statusDiv = document.getElementById('htmlExportStatus');
            const resultDiv = document.getElementById('htmlExportResult');

            statusDiv.className = 'status info';
            statusDiv.textContent = `æ­£åœ¨ç”Ÿæˆ${applyWatermark ? 'å¸¦æ°´å°' : 'æ— æ°´å°'}HTMLæ¼”ç¤ºæ–‡ç¨¿...`;

            try {
                const testSlides = [
                    {
                        background: { color: '#ffffff' },
                        elements: [
                            {
                                type: 'text',
                                content: 'VidSlide AI æµ‹è¯•æ¼”ç¤º',
                                x: 100,
                                y: 150,
                                style: { fontSize: '36px', color: '#333', fontWeight: 'bold' }
                            },
                            {
                                type: 'text',
                                content: `æ°´å°çŠ¶æ€: ${applyWatermark ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}`,
                                x: 100,
                                y: 220,
                                style: { fontSize: '18px', color: '#666' }
                            }
                        ]
                    },
                    {
                        background: { color: '#f0f8ff' },
                        elements: [
                            {
                                type: 'text',
                                content: 'ç¬¬äºŒé¡µå†…å®¹',
                                x: 100,
                                y: 180,
                                style: { fontSize: '28px', color: '#333' }
                            }
                        ]
                    }
                ];

                const result = await htmlExporter.exportHtml({
                    slides: testSlides,
                    title: `VidSlide AI ${applyWatermark ? 'å¸¦æ°´å°' : 'æ— æ°´å°'}æ¼”ç¤º`,
                    applyWatermark
                });

                statusDiv.className = 'status success';
                statusDiv.textContent = `âœ… ${applyWatermark ? 'å¸¦æ°´å°' : 'æ— æ°´å°'}HTMLæ¼”ç¤ºæ–‡ç¨¿ç”ŸæˆæˆåŠŸ`;

                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `
                    <h3>HTMLæ¼”ç¤ºæ–‡ç¨¿ç»“æœ</h3>
                    <p><strong>æ°´å°çŠ¶æ€:</strong> ${applyWatermark ? 'å·²åº”ç”¨' : 'æœªåº”ç”¨'}</p>
                    <p><strong>æ–‡ä»¶å¤§å°:</strong> ${(result.size / 1024).toFixed(1)} KB</p>
                    <p><strong>æ–‡ä»¶å:</strong> ${result.filename}</p>
                    <p><strong>å¹»ç¯ç‰‡æ•°é‡:</strong> ${testSlides.length}</p>
                    <div class="export-actions">
                        <button onclick="previewHtml('${URL.createObjectURL(result.blob)}')">
                            åœ¨æ–°çª—å£é¢„è§ˆ
                        </button>
                        <button onclick="downloadHtml('${URL.createObjectURL(result.blob)}', '${result.filename}')">
                            ä¸‹è½½HTMLæ–‡ä»¶
                        </button>
                    </div>
                `;

            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ HTMLå¯¼å‡ºå¤±è´¥: ${error.message}`;
                resultDiv.style.display = 'none';
            }
        }

        // ä¸‹è½½å’Œé¢„è§ˆåŠŸèƒ½
        window.downloadVideo = function(blobUrl, filename) {
            const a = document.createElement('a');
            a.href = blobUrl;
            a.download = filename;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        };

        window.downloadHtml = function(blobUrl, filename) {
            const a = document.createElement('a');
            a.href = blobUrl;
            a.download = filename;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        };

        window.previewHtml = function(blobUrl) {
            window.open(blobUrl, '_blank');
        };

        // å®Œæ•´æµ‹è¯•
        window.runCompleteTest = async function() {
            const btn = document.getElementById('completeTestBtn');
            const statusDiv = document.getElementById('completeTestStatus');
            const resultDiv = document.getElementById('completeTestResult');

            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';

            statusDiv.className = 'status info';
            statusDiv.textContent = 'æ­£åœ¨è¿è¡Œå®Œæ•´æ°´å°åŠŸèƒ½æµ‹è¯•...';

            try {
                const results = {
                    userTierDetection: false,
                    canvasWatermark: false,
                    videoExport: false,
                    htmlExport: false
                };

                // æµ‹è¯•ç”¨æˆ·ç­‰çº§æ£€æµ‹
                const config = watermarkGenerator.getCurrentConfig();
                results.userTierDetection = config.userTier && typeof config.showWatermark === 'boolean';

                // æµ‹è¯•Canvasæ°´å°
                const testCanvas = document.createElement('canvas');
                testCanvas.width = 200;
                testCanvas.height = 100;
                watermarkGenerator.applyToCanvas(testCanvas);
                results.canvasWatermark = true;

                // æµ‹è¯•è§†é¢‘å¯¼å‡º
                const videoCanvas = document.createElement('canvas');
                videoCanvas.width = 320;
                videoCanvas.height = 180;
                const videoResult = await videoExporter.exportVideo({
                    canvas: videoCanvas,
                    duration: 1,
                    applyWatermark: true
                });
                results.videoExport = videoResult && videoResult.blob;

                // æµ‹è¯•HTMLå¯¼å‡º
                const htmlResult = await htmlExporter.exportHtml({
                    slides: [{
                        background: { color: '#fff' },
                        elements: [{
                            type: 'text',
                            content: 'æµ‹è¯•',
                            x: 10,
                            y: 30,
                            style: { fontSize: '16px' }
                        }]
                    }],
                    applyWatermark: true
                });
                results.htmlExport = htmlResult && htmlResult.blob;

                // è®¡ç®—æˆåŠŸç‡
                const passedTests = Object.values(results).filter(Boolean).length;
                const totalTests = Object.keys(results).length;

                statusDiv.className = passedTests === totalTests ? 'status success' : 'status warning';
                statusDiv.textContent = `âœ… å®Œæ•´æµ‹è¯•å®Œæˆ: ${passedTests}/${totalTests}é¡¹é€šè¿‡`;

                resultDiv.style.display = 'block';
                resultDiv.textContent = 'å®Œæ•´åŠŸèƒ½æµ‹è¯•ç»“æœ:\n' +
                    Object.entries(results).map(([test, passed]) =>
                        `- ${test}: ${passed ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`
                    ).join('\n');

                updateOverallStatus(passedTests, totalTests);

            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ å®Œæ•´æµ‹è¯•å¤±è´¥: ${error.message}`;
                resultDiv.style.display = 'none';
            } finally {
                btn.disabled = false;
                btn.textContent = 'è¿è¡Œå®Œæ•´æµ‹è¯•';
            }
        };

        function updateOverallStatus(passed = 0, total = 4) {
            const statusDiv = document.getElementById('overallStatus');

            if (passed === total) {
                statusDiv.className = 'status success';
                statusDiv.textContent = `ğŸ‰ æ°´å°åŠŸèƒ½å®ç°æµ‹è¯•å®Œå…¨æˆåŠŸ! (${passed}/${total})`;
            } else if (passed >= total * 0.75) {
                statusDiv.className = 'status info';
                statusDiv.textContent = `âš ï¸ æ°´å°åŠŸèƒ½åŸºæœ¬å¯ç”¨ (${passed}/${total})`;
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = `âŒ æ°´å°åŠŸèƒ½å­˜åœ¨é—®é¢˜ (${passed}/${total})`;
            }
        }

        // åˆå§‹åŒ–æ˜¾ç¤º
        updateOverallStatus();
    </script>
</body>
</html>